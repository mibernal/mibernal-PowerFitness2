import { Injectable } from '@angular/core';
import * as fs from 'fs';
import * as csvParser from 'csv-parser';
import { AngularFirestore } from '@angular/fire/firestore';

@Injectable({
  providedIn: 'root'
})
export class ProductService {
  constructor(private firestore: AngularFirestore) {}

  importProductsFromCSV(filePath: string): void {
    fs.createReadStream(filePath)
      .pipe(csvParser())
      .on('data', (data) => {
        const product: Product = {
          name: data['Name'],
          description: data['Description'],
          price: parseFloat(data['Price']),
          brand: data['Brand'],
          category: data['Category'],
          size: data['Size'],
          stock: parseInt(data['Stock']),
          discount: parseFloat(data['Discount']),
          imageUrl: data['Image URL'],
          imageUrl2: data['Image URL 2'],
          imageUrl3: data['Image URL 3'],
          imageUrl4: data['Image URL 4'],
        };

        this.firestore.collection('products').add(product)
          .then(() => console.log('Product added to Firestore:', product))
          .catch((error) => console.error('Error adding product to Firestore:', error));
      })
      .on('end', () => {
        console.log('CSV file imported successfully');
      });
  }
}
