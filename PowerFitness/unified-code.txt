

/* src\app\components\auth\login-form\login-form.component.html */

<!-- login-form.component.html -->
<div class="form-container">
  <h1>Formulario de Ingreso</h1>
  <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" formControlName="email">
      <div *ngIf="loginForm.get('email')?.errors?.['required']">Se requiere un Email.</div>
      <div *ngIf="loginForm.get('email')?.errors?.['email']">Formato Invalido.</div>
    </div>
    <div>
      <label for="password">Contraseña:</label>
      <input type="password" id="password" formControlName="password">
      <div *ngIf="loginForm.get('password')?.errors?.['required']">Es necesaria una Contraseña.</div>
    </div>
    <button type="submit" [disabled]="loginForm.invalid || isSubmitting">Ingresar</button>
    <hr>
    <div class="google-btn" (click)="googleLogin()" [hidden]="isSubmitting">Ingresar con Google</div>
    <div class="facebook-btn" (click)="facebookLogin()" [hidden]="isSubmitting">Ingresar con Facebook</div>
  </form>

  <div *ngIf="!isRegistrationEnabled && !isSubmitting" class="error-message">
    No se permite el inicio de sesión. Por favor, regístrate antes de iniciar sesión.
    <a (click)="redirectToRegistration()">Regístrate aquí</a>
  </div>

  <div *ngIf="isSubmitting" class="loading-message">
    Iniciando sesión...
  </div>
</div>


/* src\app\components\auth\login-form\login-form.component.ts */

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import { Router } from '@angular/router';
import firebase from 'firebase/compat/app';
import { MatSnackBar } from '@angular/material/snack-bar';
import { AuthService } from '../../services/auth/auth.service';

@Component({
  selector: 'app-login-form',
  templateUrl: './login-form.component.html',
  styleUrls: ['./login-form.component.scss']
})
export class LoginFormComponent implements OnInit {
  loginForm: FormGroup;
  isSubmitting = false;
  isRegistrationEnabled = true; // Variable para habilitar o deshabilitar el registro
  isUserRegistered = false;

  constructor(
    private fb: FormBuilder,
    private auth: AngularFireAuth,
    private router: Router,
    private snackBar: MatSnackBar,
    private authService: AuthService // Agregar el servicio AuthService
  ) {
    this.loginForm = this.fb.group({
      email: ['', [Validators.required, Validators.email]],
      password: ['', Validators.required]
    });
  }

  ngOnInit(): void {
  }

  onSubmit(): void {
    if (this.loginForm.valid && !this.isSubmitting) {
      this.isSubmitting = true;
      const { email, password } = this.loginForm.value;
      this.authenticateUser(email, password);
    }
  }

  googleLogin(): void {
    if (!this.isSubmitting) {
      this.isSubmitting = true;
      this.auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
        .then((result: any) => {
          console.log(result);
          this.redirectToUserPanel();
        })
        .catch((error: any) => {
          this.handleAuthenticationError(error);
          console.log(error)
        })
        .finally(() => {
          this.isSubmitting = false;
        });
    }
  }

  facebookLogin(): void {
    if (!this.isSubmitting) {
      this.isSubmitting = true;
      this.auth.signInWithPopup(new firebase.auth.FacebookAuthProvider())
        .then((result: any) => {
          console.log(result);
          this.redirectToUserPanel();
        })
        .catch((error: any) => {
          this.handleAuthenticationError(error);
          console.log(error)
        })
        .finally(() => {
          this.isSubmitting = false;
        });
    }
  }

  redirectToRegistration(): void {
    this.router.navigate(['/registration-form']); // Redireccionar a la página de registro
  }

  private authenticateUser(email: string, password: string): void {
    this.auth.signInWithEmailAndPassword(email, password)
      .then((result: any) => {
        console.log(result);
        if (result.user.metadata.creationTime === result.user.metadata.lastSignInTime) {
          // El usuario es nuevo, mostrar mensaje de error
          this.isUserRegistered = false;
          this.showUserNotRegisteredError();
        } else {
          // El usuario existe, redirigir al panel de usuario
          this.redirectToUserPanel();
        }
      })
      .catch((error: any) => {
        if (error.code === 'auth/user-not-found') {
          // Usuario no registrado, mostrar mensaje de error
          this.isUserRegistered = false;
          this.showUserNotRegisteredError();
          console.log(error)
        } else {
          this.handleAuthenticationError(error);
        }
      })
      .finally(() => {
        this.isSubmitting = false;
      });
  }

  private showUserNotRegisteredError(): void {
    this.snackBar.open('El usuario no está registrado. Regístrate antes de iniciar sesión.', 'Cerrar', { duration: 3000 });
    this.redirectToRegistration(); // Redireccionar a la página de registro
  }

  private redirectToUserPanel(): void {
    this.router.navigate(['/user-panel']); // Redireccionar al panel de usuario después de iniciar sesión
  }

  private handleAuthenticationError(error: any): void {
    if (error.code === 'auth/popup-closed-by-user') {
      console.log('Autenticación cancelada por el usuario');
    } else if (error.code === 'auth/wrong-password') {
      console.log('Contraseña incorrecta');
      this.snackBar.open('Contraseña incorrecta. Por favor, verifica tus credenciales.', 'Cerrar', { duration: 3000 });
    } else {
      console.error(error);
      this.snackBar.open('Error en el inicio de sesión', 'Cerrar', { duration: 3000 });
    }
  }
}


/* src\app\components\auth\registration-form\registration-form.component.html */

<div class="form-container">
  <h1>Formulario de Registro</h1>
  <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
    <div>
      <label for="firstName">Nombres:</label>
      <input type="text" id="firstName" formControlName="firstName">
      <div *ngIf="registrationForm.get('firstName')?.invalid && registrationForm.get('firstName')?.touched">
        <div *ngIf="registrationForm.get('firstName')?.errors?.['required']">Es necesario un Nombre.</div>
      </div>
    </div>

    <div>
      <label for="lastName">Apellidos:</label>
      <input type="text" id="lastName" formControlName="lastName">
      <div *ngIf="registrationForm.get('lastName')?.invalid && registrationForm.get('lastName')?.touched">
        <div *ngIf="registrationForm.get('lastName')?.errors?.['required']">Es necesario un Apellido.</div>
      </div>
    </div>

    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" formControlName="email">
      <div *ngIf="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched">
        <div *ngIf="registrationForm.get('email')?.errors?.['email']">Formato inválido.</div>   
        <div *ngIf="registrationForm.get('email')?.errors?.['required']">Es necesario un Email.</div>
      </div>
    </div>

    <div>
      <label for="password">Contraseña:</label>
      <input type="password" id="password" formControlName="password">
      <div *ngIf="registrationForm.get('password')?.invalid && registrationForm.get('password')?.touched">
        <div *ngIf="registrationForm.get('password')?.errors?.['required']">Es necesaria una Contraseña.</div>
      </div>
    </div>

    <button type="submit" [disabled]="registrationForm.invalid">Enviar</button>

    <hr>

    <div>
      <button class="google-btn" (click)="registerWithGoogle()">Registrar con Google</button>
      <button class="facebook-btn" (click)="registerWithFacebook()">Registrar con Facebook</button>
    </div>
  </form>
</div>


/* src\app\components\auth\registration-form\registration-form.component.ts */

import { Component, OnInit, OnDestroy } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AuthService } from '../../services/auth/auth.service';
import { Router } from '@angular/router';
import { AngularFirestore } from '@angular/fire/compat/firestore';
import { MatSnackBar } from '@angular/material/snack-bar';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import firebase from 'firebase/compat/app';
import { User } from 'firebase/auth';

@Component({
  selector: 'app-registration-form',
  templateUrl: './registration-form.component.html',
  styleUrls: ['./registration-form.component.scss']
})
export class RegistrationFormComponent implements OnInit, OnDestroy {
  registrationForm!: FormGroup;
  isSubmitting = false;
  isPopupOpen = false;
  currentUserSubscription: any;

  constructor(
    private fb: FormBuilder,
    private authService: AuthService,
    private firestore: AngularFirestore,
    private snackBar: MatSnackBar,
    private router: Router,
    private auth: AngularFireAuth
  ) {}

  ngOnInit(): void {
    this.registrationForm = this.fb.group({
      firstName: ['', Validators.required],
      lastName: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      password: ['', [Validators.required, Validators.minLength(6)]]
    });
    this.currentUserSubscription = this.authService.getCurrentUser().subscribe(() => {
      // handle current user value
    });
  }

  ngOnDestroy(): void {
    this.currentUserSubscription.unsubscribe();
  }

  isEmailValid(email: string): boolean {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  async onSubmit(): Promise<void> {
    const { firstName, lastName, email, password } = this.registrationForm.value;

    if (this.registrationForm.controls['email'].invalid || !this.isEmailValid(email)) {
      console.log('Invalid email format');
      return;
    }

    try {
      // Verificar si el correo electrónico ya existe en la base de datos
      const querySnapshot = await this.firestore
        .collection('users', (ref) => ref.where('email', '==', email))
        .get()
        .toPromise();

      if (!querySnapshot?.empty) {
        console.log('Correo Electronico Ya Existe');
        // Mostrar mensaje de error
        this.snackBar.open('Correo Electronico Ya Existe', 'Cerrar', { duration: 5000 });
        return;
      }

      // Si el correo electrónico no existe, crear el usuario
      const userCredential = await this.authService.signUpWithEmailAndPassword(email, password).toPromise();
      if (userCredential?.user) {
        console.log('User created:', userCredential.user);
        // Agregar al usuario a Firestore
        const userRef = this.firestore.collection('users').doc(userCredential.user.uid);
        await userRef.set({
          firstName,
          lastName,
          email,
        });
        console.log('User added to Firestore:', userCredential.user);
        // Redirigir al panel de usuario
        this.router.navigate(['/user-panel']);
      }
    } catch (error) {
      console.log('Error creating user:', error);
    }
  }

  verifyAndRegisterWithExternalProvider(email: string, uid: string, displayName: string | null, photoURL: string | null): void {
    // Verificar si el correo electrónico ya existe en la base de datos
    this.firestore
      .collection('users', (ref) => ref.where('email', '==', email))
      .get()
      .toPromise()
      .then((querySnapshot) => {
        if (!querySnapshot?.empty) {
          console.log('Correo Electronico Ya Existe');
          // Mostrar mensaje de error
          this.snackBar.open('Correo Electronico Ya Existe', 'Cerrar', { duration: 5000 });
          return;
        }

        // Si el correo electrónico no existe, crear el usuario con el proveedor externo
        const [firstName, lastName] = (displayName || '').split(' ');
        const userRef = this.firestore.collection('users').doc(uid);
        userRef
          .set({
            firstName,
            lastName,
            email,
            password: null, // Agregar la contraseña como null al documento del usuario en Firestore
            photoURL: photoURL || '' // Agregar la foto de perfil al documento del usuario en Firestore, o cadena vacía si es null
          })
          .then(() => {
            console.log('Usuario Creado', uid);
            this.snackBar.open('Usuario Creado', 'Cerrar', { duration: 5000 });
            // Redirigir al panel de usuario
            this.router.navigate(['/user-panel']);
          })
          .catch((error) => {
            console.log('Error Creando Usuario', error);
            this.snackBar.open('Error Creando Usuario', 'Cerrar', { duration: 5000 });
          });
      })
      .catch((error) => {
        console.log('Error checking email existence:', error);
        this.snackBar.open('Error al Verificar Email', 'Cerrar', { duration: 5000 });
      });
  }

  registerWithGoogle(): void {
    if (this.isPopupOpen) {
      return;
    }

    this.isPopupOpen = true;

    this.auth
      .signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then((result: firebase.auth.UserCredential) => {
        const credential = result?.credential;
        if (credential) {
          const user = result.user;
          if (user) {
            const email = user.email ?? '';
            const photoURL = user.photoURL ?? '';
            const displayName = user.displayName ?? '';
            this.verifyAndRegisterWithExternalProvider(email, user.uid, displayName, photoURL);
          }
        }
      })
      .catch((error) => {
        this.snackBar.open('Error al registrar con Google', 'Cerrar', { duration: 5000 });
        console.log('Error registering with Google:', error);
      })
      .finally(() => {
        this.isPopupOpen = false;
      });
  }

  registerWithFacebook(): void {
    if (this.isPopupOpen) {
      return;
    }

    this.isPopupOpen = true;

    this.auth
      .signInWithPopup(new firebase.auth.FacebookAuthProvider())
      .then((result: firebase.auth.UserCredential) => {
        const credential = result?.credential;
        if (credential) {
          const user = result.user;
          if (user) {
            const email = user.email ?? '';
            const photoURL = user.photoURL ?? '';
            const displayName = user.displayName ?? '';
            this.verifyAndRegisterWithExternalProvider(email, user.uid, displayName, photoURL);
          }
        }
      })
      .catch((error) => {
        this.snackBar.open('Error al registrar con Facebook', 'Cerrar', { duration: 5000 });
        console.log('Error registering with Facebook:', error);
      })
      .finally(() => {
        this.isPopupOpen = false;
      });
  }
}


/* src\app\components\cart\cart.component.html */

<div class="cart">
  <h2>Carrito de compras</h2>
  <div *ngIf="products.length > 0; else emptyCart">
    <div class="products">
      <div *ngFor="let product of products">
        <img [src]="product.imageUrl[0]" alt="{{ product.name }}">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description }}</p>
        <p>Tamaño: {{ product.size }}</p>
        <p>Sabor: {{ getSelectedFlavor(product) }}</p>
        <p>Precio: ${{ formatPrice(product.price) }}</p>
        <button (click)="removeProduct(product)">Eliminar</button>
      </div>
    </div>
    <div class="total">
      <p>Total: ${{ getTotal() | number }}</p>
      <button (click)="completePurchase()">Finalizar Pago</button>
    </div>
  </div>

  <ng-template #emptyCart>
    <p>Tu carrito de compras está vacío.</p>
  </ng-template>
</div>


/* src\app\components\cart\cart.component.ts */

import { Component, OnInit } from '@angular/core';
import { CartService } from '../services/cart.service';
import { Product } from '../../models/product.model';
import { MatSnackBar } from '@angular/material/snack-bar';
import { Router } from '@angular/router';

@Component({
  selector: 'app-cart',
  templateUrl: './cart.component.html',
  styleUrls: ['./cart.component.scss']
})
export class CartComponent implements OnInit {
  products: Product[] = [];

  constructor(private cartService: CartService, private snackBar: MatSnackBar, private router: Router) { }

  ngOnInit(): void {
    this.products = this.cartService.getProducts();
  }

  getTotal(): number {
    return this.products.reduce((acc, product) => acc + product.price, 0);
  }

  removeProduct(product: Product): void {
    this.cartService.removeProduct(product);
    this.products = this.cartService.getProducts();
  }

  getSelectedSize(product: Product): string {
    return product.selectedSize ? product.selectedSize : 'N/A';
  }
  
  getSelectedFlavor(product: Product): string {
    return product.selectedFlavor ? product.selectedFlavor : 'N/A';
  }

  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  completePurchase(): void {

    const isSuccess = true; // Indica si la compra se ha completado con éxito
  
    if (isSuccess) {
      // Redirigir a la página de checkout
      this.router.navigate(['/checkout']);
    } else {
      // Mostrar mensaje de error
      this.snackBar.open('Ha ocurrido un error al completar la compra. Por favor, inténtalo de nuevo.', 'Cerrar', { duration: 3000 });
    }
  }  
}

/* src\app\components\checkout\checkout.component.html */

<div class="checkout-container">
  <div class="checkout-form">
    <h2>Checkout</h2>
    <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="numero_documento">Número de documento:</label>
        <input type="number" id="numero_documento" formControlName="numero_documento" required>
      </div>
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" formControlName="email" required>
      </div>
      <div class="form-group">
        <label for="nombres">Nombres:</label>
        <input type="text" id="nombres" formControlName="nombres" required>
      </div>
      <div class="form-group">
        <label for="apellidos">Apellidos:</label>
        <input type="text" id="apellidos" formControlName="apellidos" required>
      </div>
      <div class="form-group">
        <label for="departamento">Departamento:</label>
        <select id="departamento" formControlName="departamento" required (change)="onDepartmentChange(checkoutForm.value.departamento)">
          <option value="" disabled selected>Seleccione un departamento</option>
          <option *ngFor="let department of departments" [value]="department">{{ department }}</option>
        </select>
      </div>
  
      <div class="form-group">
        <label for="ciudad">Ciudad:</label>
        <select id="ciudad" formControlName="ciudad" required>
          <option value="" disabled selected>Seleccione una ciudad</option>
          <ng-container *ngFor="let ciudad of cities">
            <option [value]="ciudad">{{ ciudad }}</option>
          </ng-container>
        </select>
      </div>
      <div class="form-group">
        <label for="direccion_envio">Dirección de envío:</label>
        <input type="text" id="direccion_envio" formControlName="direccion_envio" required>
      </div>
      <div class="form-group">
        <label for="complemento">Complemento:</label>
        <input type="text" id="complemento" formControlName="complemento">
      </div>
      <div class="form-group">
        <label for="celular">Celular:</label>
        <input type="number" id="celular" formControlName="celular" required>
      </div>
      <div class="form-group">
        <label for="notas">Notas:</label>
        <textarea id="notas" formControlName="notas"></textarea>
      </div>
      <button type="submit" [disabled]="checkoutForm.invalid">Realizar pedido</button>
    </form>
  </div>

  <div class="payment-summary">
    <h2>Resumen de pedido</h2>
    <div *ngFor="let product of products" class="product-item">
      <img [src]="product.imageUrl[0]" alt="{{ product.name }}">
      <div class="product-details">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description }}</p>
        <p>Tamaño: {{ product.size }}</p>
        <p>Sabor: {{ getSelectedFlavor(product) }}</p>
        <p>Precio: ${{ formatPrice(product.price) }}</p>
      </div>
      <button (click)="removeProduct(product)">Eliminar</button>
    </div>
    <div class="total">
      <p>Total: ${{ getTotal() | number }}</p>
    </div>
    <div class="payment-options">
      <h3>Seleccione el método de pago</h3>
      <div>
      <!--  <p><button (click)="makeMercadoPagoPayment()">Pagar con MercadoPago</button></p> -->
      <!--  <p><button (click)="makePSEPayment()">Pagar con PSE</button></p> -->
      </div>
    </div>
  </div>
</div>


/* src\app\components\checkout\checkout.component.ts */

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AngularFirestore } from '@angular/fire/compat/firestore';
import { Router } from '@angular/router';
import { CartService } from '../services/cart.service';
import { Product } from 'src/app/models/product.model';
import { LocationService } from '../services/location.service';
import { Observable } from 'rxjs';

@Component({
  selector: 'app-checkout',
  templateUrl: './checkout.component.html',
  styleUrls: ['./checkout.component.scss']
})
export class CheckoutComponent implements OnInit {
  checkoutForm: FormGroup;
  products: Product[];
  total: number;
  departments: any[];
  cities: any[];

  constructor(
    private formBuilder: FormBuilder,
    private firestore: AngularFirestore,
    private cartService: CartService,
    private router: Router,
    private locationService: LocationService // Inject the LocationService
  ) {}

  ngOnInit(): void {
    this.checkoutForm = this.formBuilder.group({
      numero_documento: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      nombres: ['', Validators.required],
      apellidos: ['', Validators.required],
      departamento: ['', Validators.required],
      ciudad: ['', Validators.required],
      direccion_envio: ['', Validators.required],
      complemento: [''],
      celular: ['', Validators.required],
      notas: [''],
      fecha: ['', Validators.required],
      numero_pedido: [''],
      estado: ['']
    });

    this.products = this.cartService.getProducts();
    this.total = this.cartService.getTotal();

    // Fetch departments from the LocationService
    this.locationService.departments$.subscribe((departments) => {
      this.departments = departments;
    });

    // Initialize the cities array with an empty array
    this.cities = [];

    // Subscribe to changes in the selected department
    this.checkoutForm.get('departamento')?.valueChanges.subscribe((departmentId) => {
      if (departmentId) {
        // Fetch cities by department from the LocationService
        this.locationService.getCitiesByDepartment(departmentId).subscribe((cities) => {
          this.cities = cities;
        });
      } else {
        // If no department selected, reset the cities array
        this.cities = [];
      }
    });
  }

  onDepartmentChange(departmentId: string): void {
    if (departmentId) {
      // Fetch cities by department from the LocationService
      this.locationService.getCitiesByDepartment(departmentId).subscribe((cities: any[]) => {
        this.cities = cities;
      });
    } else {
      this.cities = [];
    }
  }

  onSubmit(): void {
    if (this.checkoutForm.invalid) {
      return;
    }

    const pedido = {
      numero_documento: this.checkoutForm.value.numero_documento,
      email: this.checkoutForm.value.email,
      nombres: this.checkoutForm.value.nombres,
      apellidos: this.checkoutForm.value.apellidos,
      departamento: this.checkoutForm.value.departamento,
      ciudad: this.checkoutForm.value.ciudad,
      direccion_envio: this.checkoutForm.value.direccion_envio,
      complemento: this.checkoutForm.value.complemento,
      celular: this.checkoutForm.value.celular,
      notas: this.checkoutForm.value.notas,
      fecha: this.checkoutForm.value.fecha,
      numero_pedido: '', // Se generará automáticamente en Firestore
      estado: '' // Se establecerá automáticamente en Firestore
    };

    this.firestore
      .collection('pedidos')
      .add(pedido)
      .then((docRef: { id: any; }) => {
        const numeroPedido = docRef.id;
        this.firestore
          .collection('pedidos')
          .doc(numeroPedido)
          .update({
            numero_pedido: numeroPedido,
            estado: 'pendiente'
          })
          .then(() => {
            console.log('Pedido guardado exitosamente.');
            // Aquí puedes redirigir al usuario a la página de éxito del pedido
          })
          .catch((error: any) => {
            console.error('Error al actualizar el número de pedido y estado:', error);
          });
      })
      .catch((error: any) => {
        console.error('Error al guardar el pedido:', error);
      });
  }

  getSelectedFlavor(product: Product): string {
    return product.selectedFlavor ? product.selectedFlavor : 'N/A';
  }
  
  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  removeProduct(product: Product): void {
    this.cartService.removeProduct(product);
    this.products = this.cartService.getProducts();
    this.total = this.cartService.getTotal();
  }

  getTotal(): number {
    return this.total;
  }
}

/* src\app\components\contact\contact.component.html */

<div class="container">
  <h1>Contáctanos</h1>
  <div class="row">
    <div class="col-md-6">
      <h3>Ubicación</h3>
      <p>Estamos ubicados en Bogotá y Hacemos envios a todo el pais¡.</p>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3976.062868153577!2d-74.0646823842646!3d4.697542342809965!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e3f8a84ce4b3719%3A0xeb13a526a824c6b4!2sBogot%C3%A1%2C%20Colombia!5e0!3m2!1sen!2sus!4v1620354656928!5m2!1sen!2sus" width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    </div>
    <div class="col-md-6">
      <h3>Contáctanos</h3>
      <form>
        <div class="form-group">
          <label for="name">Nombre</label>
          <input type="text" class="form-control" id="name" placeholder="Ingresa tu nombre">
        </div>
        <div class="form-group">
          <label for="email">Correo electrónico</label>
          <input type="email" class="form-control" id="email" placeholder="Ingresa tu correo electrónico">
        </div>
        <div class="form-group">
          <label for="message">Mensaje</label>
          <textarea class="form-control" id="message" rows="5" placeholder="Ingresa tu mensaje"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Enviar mensaje</button>
      </form>
      <div class="mt-4">
        <p>También puedes contactarnos por:</p>
        <ul>
          <li><a href="tel:+573124193753"><i class="fa fa-phone mr-2"></i>+57 3124193753</a></li>
          <li><a href="https://wa.me/573124193753"><i class="fa fa-whatsapp mr-2"></i>+57 3124193753</a></li>
          <li><a href="mailto:contacto@tutiendafit.com"><i class="fa fa-envelope mr-2"></i>contacto@tutiendafit.com</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


/* src\app\components\contact\contact.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-contact',
  templateUrl: './contact.component.html',
  styleUrls: ['./contact.component.scss']
})
export class ContactComponent {

}


/* src\app\components\home\home.component.html */

<main>
  <section class="py-5 bg-light">
    <div class="container">
      <h1 class="text-center mb-5">Bienvenido a PowerFitness</h1>

      <!-- Agregar el slider aquí -->
      <div class="carousel-container">
        <ngx-slick-carousel class="carousel" [config]="carouselConfig">
          <div *ngFor="let brand of brands" class="carousel-item">
            <img [src]="brand.image[0]" alt="{{ brand.brand }}" class="brand-logo">
          </div>
        </ngx-slick-carousel>
      </div>

      <h1 class="text-center mb-5">Productos en Oferta</h1>
      <div class="row">
        <div *ngFor="let product of products" class="col-md-4 col-sm-6 mb-4">
          <div class="card shadow-sm">
            <img class="card-img-top" [src]="product.imageUrl" alt="{{ product.name }}">
            <div class="card-body">
              <h4 class="card-title">{{ product.name }}</h4>
              <p class="card-text">{{ product.description }}</p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-outline-secondary">Ver más</button>
                  <button type="button" class="btn btn-sm btn-outline-secondary">Comprar</button>
                </div>
                <small class="text-muted">${{ formatPriceWithThousandsSeparator(product.price) }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>


/* src\app\components\home\home.component.ts */

import { Component, OnInit, ViewChild } from '@angular/core';
import { ProductService } from '../services/product.service';
import { BrandService } from '../services/brand/brand.service';
import { Product } from '../../models/product.model';
import { Brand } from '../../models/brand.model';
import { SlickCarouselComponent } from 'ngx-slick-carousel';
import { DecimalPipe } from '@angular/common';

@Component({
  selector: 'app-home',
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.scss']
})
export class HomeComponent implements OnInit {
  @ViewChild('slickModal', { static: true }) slickModal: SlickCarouselComponent;

  products: Product[] = [];
  brands: Brand[];

  carouselConfig: any = {
    slidesToShow: 4,
    slidesToScroll: 1,
    dots: true,
    arrows: true,
    autoplay: true,
    autoplaySpeed: 3000,
    infinite: true
  };

  constructor(
    private productService: ProductService,
    private brandService: BrandService,
    private decimalPipe: DecimalPipe
  ) {}

  ngOnInit() {
    this.productService.getProducts().subscribe((products: Product[]) => {
      // Obtener 6 productos aleatorios
      this.products = this.getRandomProducts(products, 6);
    });

    this.brandService.getBrands().subscribe((brands: Brand[]) => {
      this.brands = brands;
      this.updateCarousel();
    });
  }

  // Función para obtener productos aleatorios
  private getRandomProducts(products: Product[], count: number): Product[] {
    const randomProducts: Product[] = [];
    const totalProducts = products.length;

    if (totalProducts <= count) {
      return products;
    }

    const selectedIndices: number[] = [];

    while (randomProducts.length < count) {
      const randomIndex = Math.floor(Math.random() * totalProducts);

      if (!selectedIndices.includes(randomIndex)) {
        selectedIndices.push(randomIndex);
        randomProducts.push(products[randomIndex]);
      }
    }

    return randomProducts;
  }

  updateCarousel() {
    // Actualizar el número de slidesToShow del carrusel
    // según el número de marcas disponibles
    const numBrands = this.brands.length;
    this.carouselConfig.slidesToShow = Math.min(numBrands, 5);

    // Reiniciar el carrusel para reflejar los cambios
    if (this.slickModal) {
      this.slickModal.unslick();
      this.slickModal.initSlick();
    }
  }

  formatPriceWithThousandsSeparator(price: number | null): string {
    if (price == null) return '';
  
    // Usar toLocaleString para agregar separadores de miles
    const formattedPrice = price.toLocaleString(undefined, { minimumFractionDigits: 0 });
  
    // Reemplazar la coma por un punto
    return formattedPrice.replace(',', '.');
  }
}


/* src\app\components\layout\footer\footer.component.html */

<footer class="bg-dark text-white py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5>PowerFitness</h5>
          <p>Tienda de artículos deportivos en Bogotá, Colombia. Envíos a todo el país.</p>
          <p>Teléfono: +573124193753</p>
        </div>
        <div class="col-md-4">
          <h5>Enlaces</h5>
          <ul class="list-unstyled">
            <li><a href="#">Inicio</a></li>
            <li><a href="#">Categorías</a></li>
            <li><a href="#">Productos</a></li>
            <li><a href="#">Nosotros</a></li>
            <li><a href="#">Descuentos</a></li>
            <li><a href="#">Contacto</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5>Síguenos</h5>
          <ul class="list-unstyled">
            <li><a href="#">Facebook</a></li>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">Instagram</a></li>
          </ul>
        </div>
      </div>
      <hr>
      <p class="text-muted small mb-0">© 2023 PowerFitness</p>
    </div>
  </footer>
  

/* src\app\components\layout\footer\footer.component.ts */

import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-footer',
  templateUrl: './footer.component.html',
  styleUrls: ['./footer.component.scss']
})
export class FooterComponent implements OnInit {

  constructor() { }

  ngOnInit(): void {
  }

}


/* src\app\components\layout\header\header.component.html */



/* src\app\components\layout\header\header.component.ts */

import { Component, OnInit } from '@angular/core';
import { NavbarComponent } from '../../navbar/navbar.component';

@Component({
  selector: 'app-header',
  templateUrl: './header.component.html',
  styleUrls: ['./header.component.scss']
})
export class HeaderComponent implements OnInit {

  constructor() { }

  ngOnInit(): void {
  }

}


/* src\app\components\logout\logout.component.html */

<p>logout works!</p>


/* src\app\components\logout\logout.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-logout',
  templateUrl: './logout.component.html',
  styleUrls: ['./logout.component.scss']
})
export class LogoutComponent {

}


/* src\app\components\navbar\navbar.component.html */

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" routerLink="/">PowerFitness</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" routerLink="/home" routerLinkActive="active">Inicio</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" routerLink="/categorias" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Categorías
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              <li><a class="dropdown-item" href="#">Proteínas</a></li>
              <li><a class="dropdown-item" href="#">Pre-entrenamientos</a></li>
              <li><a class="dropdown-item" href="#">Quemadores de grasa</a></li>
              <li><a class="dropdown-item" href="#">Vitaminas y minerales</a></li>
              <li><a class="dropdown-item" href="#">Accesorios de entrenamiento</a></li>
              <li><a class="dropdown-item" href="#">Ropa deportiva</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/product-list" routerLinkActive="active">Productos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/nosotros" routerLinkActive="active">Nosotros</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/sale" routerLinkActive="active">Ofertas!</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/contact" routerLinkActive="active">Contacto</a>
          </li>
        </ul>
        <form class="d-flex" (ngSubmit)="searchForm.ngSubmit.emit()">
          <input class="form-control me-2" type="search" placeholder="Buscar" aria-label="Buscar" [(ngModel)]="searchQuery" name="searchQuery">
          <button class="btn btn-outline-success" type="submit">Buscar</button>
        </form>
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" routerLink="/login-form" routerLinkActive="active">Iniciar Sesión</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/register" routerLinkActive="active">Registro</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/cart" routerLinkActive="active">
              <span class="bi bi-cart"></span>
              <span class="cart-items">{{ cartItemCount }}</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


/* src\app\components\navbar\navbar.component.ts */

import { Component, ViewChild, OnInit } from '@angular/core';
import { NgForm } from '@angular/forms';
import { CartService } from '../services/cart.service';
import { ProductService } from '../services/product.service';

@Component({
  selector: 'app-navbar',
  templateUrl: './navbar.component.html',
  styleUrls: ['./navbar.component.scss']
})

export class NavbarComponent implements OnInit {
  @ViewChild('searchForm') searchForm: NgForm;
  searchQuery: string;

  cartItemCount: number = 0;  // Variable para almacenar el número de elementos en el carrito

  constructor(private productService: ProductService) {}

  ngOnInit() {
    this.productService.addToCart$.subscribe(() => {
      this.cartItemCount++;
    });
  }

  // ...
}

/* src\app\components\nosotros\nosotros.component.html */

<section class="nosotros">
  <div class="container">
    <h2 class="nosotros-title">Bienvenidos a PowerFitness</h2>
    <p class="nosotros-description">
      En nuestro compromiso por ayudarte a alcanzar tus objetivos de manera eficiente y segura, te ofrecemos una amplia variedad de productos y servicios especializados en el ámbito deportivo.
    </p>
    <p class="nosotros-description">
    Nos especializamos en la venta de  suplementos deportivos de alta calidad, entre los que destacan nuestra selección de proteínas, pre-entrenamientos, quemadores de grasa, vitaminas y minerales, así como accesorios de entrenamiento y ropa deportiva.
    Contamos con las mejores marcas del mercado para garantizarte los resultados que esperas, sin comprometer tu salud ni seguridad. Todos nuestros productos son seleccionados cuidadosamente y sometidos a rigurosos controles de calidad para garantizar que cumplen con los estándares más exigentes.
    </p>
    <p class="nosotros-description">
      Además, en PowerFitness no solo te ofrecemos productos de calidad, sino también asesoramiento personalizado para que puedas elegir los suplementos deportivos que mejor se adapten a tus necesidades y objetivos. Nos enfocamos en entender tus necesidades específicas para ofrecerte recomendaciones personalizadas y así puedas alcanzar tus metas de forma más efectiva.
    </p>
    <p class="nosotros-description">
      En definitiva, en PowerFitness estamos comprometidos en ser tu aliado en el camino hacia una vida más saludable y activa, ofreciéndote siempre los mejores productos y servicios para que puedas alcanzar tus metas de forma eficiente y segura. No dudes en visitar nuestra tienda virtual y comprobar por ti mismo la calidad de nuestra oferta.
    </p>
    <a class="nosotros-button" href="product-list">Explora nuestros productos</a>
  </div>
</section>


/* src\app\components\nosotros\nosotros.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-nosotros',
  templateUrl: './nosotros.component.html',
  styleUrls: ['./nosotros.component.scss']
})
export class NosotrosComponent {

}


/* src\app\components\product-import\product-import.component.html */

<div>
    <h1>Product Import</h1>
    <input type="file" #fileInput (change)="handleFileInput(fileInput)">
    <button (click)="importCSV()"> Import CSV </button>
  </div>

/* src\app\components\product-import\product-import.component.ts */

import { Component } from '@angular/core';
import { CsvParserService } from '../../services/csv-parser.service';

@Component({
  selector: 'app-product-import',
  templateUrl: './product-import.component.html',
  styleUrls: ['./product-import.component.scss']
})
export class ProductImportComponent {
  file: File;

  constructor(private csvParserService: CsvParserService) {}

  handleFileInput(input: HTMLInputElement): void {
    const files = input.files;
    if (files && files.length > 0) {
      this.file = files[0];
    }
  }

  importCSV(): void {
    if (this.file) {
      this.csvParserService.importProductsFromCSV(this.file);
    }
  }
}


/* src\app\components\product-management\product-management.component.html */

<div>
  <h1>Product Management</h1>
  <input type="file" #fileInput (change)="handleFileInput(fileInput)">
  <button (click)="exportToCSV()">Exportar CSV</button>
</div>


/* src\app\components\product-management\product-management.component.ts */

import { Component } from '@angular/core';
import { CsvWriterService } from '../../services/csv-writer.service';
import { ProductService } from '../services/product.service';
import { Product } from '../../models/product.model';

@Component({
  selector: 'app-product-management',
  templateUrl: './product-management.component.html',
  styleUrls: ['./product-management.component.scss']
})
export class ProductManagementComponent {
  file: File;

  constructor(
    private csvWriterService: CsvWriterService,
    private productService: ProductService
  ) {}

  handleFileInput(input: HTMLInputElement): void {
    const files = input.files;
    if (files && files.length > 0) {
      this.file = files[0];
    }
  }

  exportToCSV(): void {
    this.productService.getProducts().subscribe((products: Product[]) => {
      this.csvWriterService.generateCSV(products);
    });
  }
}


/* src\app\components\products\product\product.component.html */

<p>product works!</p>


/* src\app\components\products\product\product.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-product',
  templateUrl: './product.component.html',
  styleUrls: ['./product.component.scss']
})
export class ProductComponent {

}


/* src\app\components\products\product-detail\product-detail.component.html */

<!-- product-detail.component.html -->
<div class="container" *ngIf="product">
    <div class="row">
      <div class="col-12">
        <div class="card product">
          <div class="image-wrapper">
            <div class="image-container">
              <button class="arrow left-arrow" (click)="setCurrentImageIndex(currentImageIndex - 1)">&lt;</button>
              <div class="images">
                <img class="card-img-top product-image" [src]="product.imageUrl || ''" alt="{{ product.name }}" />
              </div>
              <button class="arrow right-arrow" (click)="setCurrentImageIndex(currentImageIndex + 1)">&gt;</button>
            </div>
          </div>
          <div class="card-body">
            <h5 class="card-title product-name">{{ product.name }}</h5>
            <p class="card-text product-category" *ngIf="product?.category?.length">
              Categoría: {{ product.category }}
            </p>
            <p class="card-text product-brand" *ngIf="product?.brand?.length">Marca: {{ product.brand }}</p>
            <p class="card-text product-size" *ngIf="product?.sizes?.length">
              Tamaño:
              <select [(ngModel)]="product.selectedSize" (change)="filterProductsBySize()">
                <option *ngFor="let size of product.sizes" [value]="size">{{ size }}</option>
              </select>
            </p>
            <p class="card-text product-size" *ngIf="product?.size?.length">Tamaño: {{ product.size }}</p>
            <p class="card-text product-flavor" *ngIf="product?.flavors?.length">
              Sabor:
              <select [(ngModel)]="product.selectedFlavor" (change)="filterProductsByFlavor()">
                <option *ngFor="let flavor of product.flavors" [value]="flavor">{{ flavor }}</option>
              </select>
            </p>
            <p class="card-text product-flavor" *ngIf="product?.flavors?.length === 1">Sabor: {{ product.flavors[0] }}</p>
            <p class="card-text product-stock" *ngIf="product?.stock !== undefined && product.stock !== 0">
              Stock: {{ product.stock }}
            </p>
            <p class="card-text product-description" *ngIf="product?.description">{{ product.description }}</p>
            <p class="card-text product-discount" *ngIf="product?.discount !== undefined && product.discount !== 0">
              Descuento: {{ product.discount }}
            </p>
            <p class="card-text product-price" *ngIf="product?.price !== undefined && product.price !== 0">
              {{ formatPrice(product.price || 0) }}
            </p>
            <button class="btn btn-primary add-to-cart-button" (click)="addProduct(product)">Añadir al Carrito</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  

/* src\app\components\products\product-detail\product-detail.component.ts */

import { Component, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { ProductService } from '../../services/product.service';
import { Product } from '../../../models/product.model';
import { CartService } from '../../services/cart.service';
import { Router } from '@angular/router';

@Component({
  selector: 'app-product-detail',
  templateUrl: './product-detail.component.html',
  styleUrls: ['./product-detail.component.scss'],
})
export class ProductDetailComponent implements OnInit {
  products: Product[] = [];
  selectedSize: string = '';
  selectedFlavor: string = '';
  selectedCategory: string = '';
  productCategories: string[] = [];
  productSizes: string[] = [];
  productFlavors: string[] = [];
  filteredProducts: Product[] = [];
  confirmationMessage: string = '';
  currentImageIndex: number = 0;
  product: Product | undefined;

  constructor(
    private productService: ProductService,
    private cartService: CartService,
    private route: ActivatedRoute,
    private router: Router
  ) {}

  ngOnInit() {
    const productId = this.route.snapshot.params['id'];
    this.productService.getProducts().subscribe(
      (products: Product[]) => {
        this.product = products.find(product => product.id === productId);
        if (!this.product) {
          console.error('Product not found');
        }
      },
      (error: any) => {
        console.error('Error retrieving products:', error);
      }
    );
  }  

  getProduct(): void {
    const id = this.route.snapshot.paramMap.get('id');
    if (id) {
      this.productService.getProductById(id).subscribe(
        (product: Product) => {
          if (product) {
            this.product = product;
          } else {
            console.error('Product not found');
          }
        },
        (error: any) => {
          console.error(error);
        }
      );
    }
  }
  
  setCurrentImageIndex(index: number): void {
    this.currentImageIndex = index;
  }

  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  addProduct(product: Product): void {
    if ((product.flavors && product.flavors.length > 0 && !product.selectedFlavor) || (product.sizes && product.sizes.length > 0 && !product.selectedSize)) {
      this.confirmationMessage = '';
      return;
    }
    
    const selectedProduct = { ...product };
    this.selectedSize = this.selectedSize;
    this.selectedFlavor = this.selectedFlavor;

    this.cartService.addProduct(selectedProduct);
    this.productService.addProductToCart(selectedProduct);
    this.confirmationMessage = 'Producto agregado al carrito: ' + product.name;

    this.selectedSize = '';
    this.selectedFlavor = '';
  }
  

  filterProductsBySize(): void {
    if (this.selectedSize) {
      this.filteredProducts = this.products.filter(
        (product) => product.size === this.selectedSize
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  filterProductsByFlavor(): void {
    if (this.selectedFlavor) {
      this.filteredProducts = this.products.filter(
        (product) => product.flavors.includes(this.selectedFlavor)
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  checkAvailability(product: Product): void {
    const selectedProduct = { ...product };
    if (selectedProduct.id !== undefined) {
      selectedProduct.id = selectedProduct.id.toString();
      this.productService
        .getProductById(selectedProduct.id)
        .subscribe((dbProduct: Product) => {
          // ...
        });
    } else {
      // Manejar el caso en que el ID del producto sea undefined
    }
  }
}

/* src\app\components\products\product-list\product-list.component.html */

<!-- product-list.component.html -->
<div class="container">
  <div class="row">
    <div class="col-12 col-lg-3">
      <div class="category-menu">
        <h5>Categorías:</h5>
        <ul>
          <li *ngFor="let category of productCategories" (click)="filterProductsByCategory(category)">
            {{ category }}
          </li>
        </ul>
      </div>
    </div>

    <div class="col-12 col-lg-9">
      <div class="row">
        <div *ngIf="confirmationMessage" class="confirmation-message col-12">
          {{ confirmationMessage }}
        </div>
        <div class="col-12 col-md-6 col-lg-4" *ngFor="let product of filteredProducts">
          <div class="card product">
            <div class="image-wrapper">
              <div class="image-container">
                <button class="arrow left-arrow" (click)="scrollImages(product, -1)">&lt;</button>
                <div class="images">
                  <img class="card-img-top product-image" [src]="product.imageUrl[currentImageIndex]" alt="{{ product.name }}" />
                </div>
                <button class="arrow right-arrow" (click)="scrollImages(product, 1)">&gt;</button>
              </div>
            </div>
            <div class="card-body">
              <h5 class="card-title product-name">
                <a *ngIf="product.id" (click)="viewProductDetails(product.id)" [title]="product.name">{{ product.name }}</a>
                <span *ngIf="!product.id" [title]="product.name">{{ product.name }}</span>
              </h5>
              <p class="card-text product-category" *ngIf="product.category && product.category.length > 0">
                Categoría: {{ product.category }}
              </p>
              <p class="card-text product-brand" *ngIf="product.brand && product.brand.length > 0">Marca: {{ product.brand }}</p>
              <p class="card-text product-size" *ngIf="product.sizes && product.sizes.length > 0">
                Tamaño:
                <select [(ngModel)]="product.selectedSize" (change)="filterProductsBySize()">
                  <option *ngFor="let size of product.sizes" [value]="size">{{ size }}</option>
                </select>
              </p>
              <p class="card-text product-size" *ngIf="product.size && product.size.length > 0">
                Tamaño: {{ product.size }}
              </p>
              <p class="card-text product-flavor" *ngIf="product.flavors && product.flavors.length > 0">
                Sabor:
                <select [(ngModel)]="product.selectedFlavor" (change)="filterProductsByFlavor()">
                  <option *ngFor="let flavor of product.flavors" [value]="flavor">{{ flavor }}</option>
                </select>
              </p>
              <p class="card-text product-flavor" *ngIf="product.flavors && product.flavors.length === 1">
                Sabor: {{ product.flavors[0] }}
              </p>
              <p class="card-text product-stock" *ngIf="product.stock !== undefined && product.stock !== 0">
                Stock: {{ product.stock }}
              </p>
              <p class="card-text product-description" *ngIf="product.description">{{ product.description }}</p>
              <p class="card-text product-discount" *ngIf="product.discount !== undefined && product.discount !== 0">
                Descuento: {{ product.discount }}
              </p>
              <p class="card-text product-price" *ngIf="product.price !== undefined && product.price !== 0">
               ${{ formatPrice(product.price) }}
              </p>
              <button class="btn btn-primary add-to-cart-button" (click)="addProduct(product)">Añadir al Carrito</button>
              <button class="btn btn-primary view-more-button" *ngIf="product.id" (click)="viewProductDetails(product.id)">Ver más</button>
              <p class="error-message" *ngIf="product.flavors && product.flavors.length > 0 && !product.selectedFlavor">Selecciona un sabor</p>
              <p class="error-message" *ngIf="product.sizes && product.sizes.length > 0 && !product.selectedSize">Selecciona un tamaño</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


/* src\app\components\products\product-list\product-list.component.ts */

// product-list.component.ts
import { Component, OnInit } from '@angular/core';
import { ProductService } from '../../services/product.service';
import { Product } from '../../../models/product.model';
import { CartService } from '../../services/cart.service';
import { Router } from '@angular/router';
import { ImageIndexMixin } from '../../services/product/image-index.mixin';

// Extiende el tipo Product con la interfaz ImageIndexMixin
type ProductWithImageIndex = Product & ImageIndexMixin;

@Component({
  selector: 'app-product-list',
  templateUrl: 'product-list.component.html',
  styleUrls: ['product-list.component.scss'],
})
export class ProductListComponent implements OnInit {
  products: ProductWithImageIndex[] = [];
  selectedSize: string = '';
  selectedFlavor: string = '';
  selectedCategory: string = '';
  productCategories: string[] = [];
  productSizes: string[] = [];
  productFlavors: string[] = [];
  filteredProducts: Product[] = [];
  confirmationMessage: string = '';
  currentImageIndex: number = 0;
  

  constructor(
    private productService: ProductService,
    private cartService: CartService,
    private router: Router
  ) {}

  ngOnInit() {
    this.productService.getProducts().subscribe((products: Product[]) => {
      this.products = products.map((product) => ({
        ...product,
        selectedSize: '',
        selectedFlavor: '',
      }));

      this.productCategories = Array.from(new Set(this.products.map((product) => product.category)));
      this.productSizes = Array.from(new Set(this.products.map((product) => product.size)));
      this.productFlavors = Array.from(new Set(this.products.flatMap((product) => product.flavors)));
      this.filteredProducts = [...this.products];
    });
  }

  addProduct(product: Product): void {
    if ((product.flavors && product.flavors.length > 0 && !product.selectedFlavor) || (product.sizes && product.sizes.length > 0 && !product.selectedSize)) {
      this.confirmationMessage = '';
      return;
    }
    
    const selectedProduct = { ...product };
    this.selectedSize = this.selectedSize;
    this.selectedFlavor = this.selectedFlavor;

    this.cartService.addProduct(selectedProduct);
    this.productService.addProductToCart(selectedProduct);
    this.confirmationMessage = 'Producto agregado al carrito: ' + product.name;

    this.selectedSize = '';
    this.selectedFlavor = '';
  }

  scrollImages(product: ProductWithImageIndex, direction: number): void {
    const imageUrls = product.imageUrl;
    const lastIndex = imageUrls.length - 1;
  
    // Obtén el índice actual de la imagen para este producto
    const currentImageIndex = product.currentImageIndex || 0;
  
    // Calcula el nuevo índice
    let newImageIndex = currentImageIndex + direction;
  
    if (newImageIndex > lastIndex) {
      newImageIndex = 0;
    } else if (newImageIndex < 0) {
      newImageIndex = lastIndex;
    }
  
    // Actualiza el índice de la imagen para este producto
    product.currentImageIndex = newImageIndex;
  }
  
  checkAvailability(product: Product): void {
    const selectedProduct = { ...product };
    if (selectedProduct.id !== undefined) {
      selectedProduct.id = selectedProduct.id.toString();
      this.productService
        .getProductById(selectedProduct.id)
        .subscribe((dbProduct: Product) => {
          // ...
        });
    } else {
      // Manejar el caso en que el ID del producto sea undefined
    }
  }

  filterProductsByCategory(category?: string): void {
    if (category) {
      this.selectedCategory = category;
      this.filteredProducts = this.products.filter(
        (product) => product.category === category
      );
    } else {
      this.selectedCategory = '';
      this.filteredProducts = [...this.products];
    }
  }

  filterProductsBySize(): void {
    if (this.selectedSize) {
      this.filteredProducts = this.products.filter(
        (product) => product.size === this.selectedSize
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  filterProductsByFlavor(): void {
    if (this.selectedFlavor) {
      this.filteredProducts = this.products.filter(
        (product) => product.flavors.includes(this.selectedFlavor)
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  viewProductDetails(productId: string): void {
    this.router.navigate(['/products', productId]);
  }
}


/* src\app\components\search\search.component.html */

<form class="d-flex" (ngSubmit)="searchProducts()">
    <input class="form-control me-2" type="search" placeholder="Buscar" aria-label="Buscar" [(ngModel)]="searchQuery" name="searchQuery">
    <button class="btn btn-outline-success" type="submit">Buscar</button>
  </form>
  

/* src\app\components\search\search.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-search',
  templateUrl: './search.component.html',
  styleUrls: ['./search.component.scss']
})
export class SearchComponent {
  searchQuery: string;

  searchProducts(): void {
    // Aquí puedes agregar la lógica para realizar la búsqueda
    console.log('Realizando búsqueda: ' + this.searchQuery);
  }
}


/* src\app\components\services\auth\auth.service.ts */

// auth.service.ts
import { Injectable } from '@angular/core';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import { Observable, from, throwError } from 'rxjs';
import { User, UserCredential } from '@firebase/auth-types';
import firebase from 'firebase/compat/app';
import 'firebase/compat/auth';
import { AngularFirestore } from '@angular/fire/compat/firestore';
import { Subscription } from 'rxjs';
import { switchMap, take, catchError } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  logout() {
    throw new Error('Method not implemented.');
  }
  user$: Observable<User | null>;

  constructor(private afAuth: AngularFireAuth, private firestore: AngularFirestore) {
    this.user$ = this.afAuth.authState;
  }

  signUpWithEmailAndPassword(email: string, password: string): Observable<UserCredential> {
    return from(this.afAuth.createUserWithEmailAndPassword(email, password)).pipe(
      catchError((error) => {
        console.error('Error signing up:', error);
        return throwError(error);
      })
    );
  }  

  signInWithGoogle(): Observable<UserCredential> {
    const provider = new firebase.auth.GoogleAuthProvider();
    return from(this.afAuth.signInWithPopup(provider)).pipe(
      catchError((error) => {
        console.error('Error signing in with Google:', error);
        return throwError(error);
      })
    );
  }  

  signInWithFacebook(): Observable<UserCredential> {
    const provider = new firebase.auth.FacebookAuthProvider();
    return from(this.afAuth.signInWithPopup(provider)).pipe(
      catchError((error) => {
        console.error('Error signing in with Facebook:', error);
        return throwError(error);
      })
    );
  }

  signOut(): Promise<void> {
    return this.afAuth.signOut().catch((error) => {
      console.error('Error signing out:', error);
      throw error;
    });
  }
  
  updateUserProfile(name: string, email: string): Observable<void> {
    return this.getCurrentUser().pipe(
      switchMap((user) => {
        if (user) {
          const userId = user.uid;
          return from(this.firestore.collection('users').doc(userId).update({ name, email })).pipe(
            catchError((error) => {
              console.error('Error updating user profile:', error);
              return throwError(error);
            })
          );
        } else {
          return throwError(new Error('User not authenticated'));
        }
      })
    );
  }

  changeUserPassword(currentPassword: string, newPassword: string): Observable<void> {
    return this.getCurrentUser().pipe(
      switchMap((user) => {
        if (user) {
          const credential = firebase.auth.EmailAuthProvider.credential(user.email || '', currentPassword);
          return from(user.reauthenticateWithCredential(credential)).pipe(
            switchMap(() => from(user.updatePassword(newPassword))),
            catchError((error) => {
              console.error('Error changing password:', error);
              return throwError(error);
            })
          );
        } else {
          return throwError(new Error('User not authenticated'));
        }
      })
    );
  }

  getCurrentUser(): Observable<User | null> {
    return this.afAuth.authState.pipe(take(1));
  }

  unsubscribeAuthState(): void {
    // Implement the logic for unsubscribing authState here
  }
  
}


/* src\app\components\services\brand\brand.service.ts */

import { Injectable } from '@angular/core';
import { map, Observable, from } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Brand } from '../../../models/brand.model';
import {
  collection,
  CollectionReference,
  doc,
  DocumentData,
  getDoc,
  getDocs,
  getFirestore,
  query,
  QuerySnapshot,
  orderBy,
} from 'firebase/firestore';
import { environment } from 'src/environments/environment';
import { initializeApp } from 'firebase/app';

@Injectable({
  providedIn: 'root',
})
export class BrandService {
  private firestore: any;
  private collectionRef: CollectionReference<DocumentData>;

  constructor() {
    const app = initializeApp(environment.firebase);
    const firestore = getFirestore(app);
    this.collectionRef = collection(firestore, 'brands');
  }

  getBrands(): Observable<Brand[]> {
    const brandsQuery = query(this.collectionRef, orderBy('brand'));
    return from(getDocs(brandsQuery)).pipe(
      map((querySnapshot: QuerySnapshot<DocumentData>) =>
        querySnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() as Brand }))
      )
    );
  }

  getBrandById(id: string): Observable<Brand> {
    const brandDocRef = doc(this.collectionRef, id);
    return new Observable((observer) => {
      getDoc(brandDocRef)
        .then((brandDoc: DocumentData) => {
          if (brandDoc['exists']()) {
            const brand = brandDoc['data']() as Brand;
            brand.id = brandDoc['id'];
            observer.next(brand);
          } else {
            observer.error('Brand not found');
          }
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }
}


/* src\app\components\services\cart.service.ts */

import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { Product } from '../../models/product.model';

@Injectable({
  providedIn: 'root'
})
export class CartService {
  private products: Product[] = [];
  private cartItemCount: number = 0;

  getCartItemCount(): number {
    return this.cartItemCount;
  }

  addProduct(product: Product): void {
    this.products.push(product);
    this.cartItemCount++;
  }

  removeProduct(product: Product): void {
    const index = this.products.findIndex(p => p.id === product.id);
    if (index !== -1) {
      this.products.splice(index, 1);
      this.cartItemCount--;
    }
  }

  getProducts(): Product[] {
    return this.products;
  }

  clearCart(): void {
    this.products = [];
    this.cartItemCount = 0;
  }

  getTotal(): number {
    return this.products.reduce((acc, product) => acc + product.price, 0);
  }
}


/* src\app\components\services\firebase-test\firebase-test.component.html */

<p>firebase-test works!</p>


/* src\app\components\services\firebase-test\firebase-test.component.ts */

import { Component, OnInit } from '@angular/core';
import { AngularFirestore } from '@angular/fire/compat/firestore';

@Component({
  selector: 'app-firebase-test',
  templateUrl: './firebase-test.component.html',
  styleUrls: ['./firebase-test.component.scss']
})
export class FirebaseTestComponent implements OnInit {

  constructor(private firestore: AngularFirestore) { }

  ngOnInit(): void {
    // Verificar la conexión a Firebase
    console.log('Conectando a Firebase...');
    this.firestore.firestore.enableNetwork().then(() => {
      console.log('Conectado a Firebase!');
      // Leer datos de Firestore
      this.firestore.collection('products').get().subscribe((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          console.log(doc.id, ' => ', doc.data());
        });
      });
    }).catch((error) => {
      console.log('Error de conexión:', error);
    });
  }
}


/* src\app\components\services\location.service.ts */

import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, BehaviorSubject } from 'rxjs';
import { map } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class LocationService {
  private apiUrl = 'https://www.datos.gov.co/resource/xdk5-pm3f.json';
  private departmentsSubject = new BehaviorSubject<string[]>([]);
  departments$ = this.departmentsSubject.asObservable();
  private citiesSubject = new BehaviorSubject<string[]>([]);
  cities$ = this.citiesSubject.asObservable();

  constructor(private http: HttpClient) {
    this.fetchDepartments();
  }

  private fetchDepartments(): void {
    this.http.get<any[]>(this.apiUrl).subscribe(
      (departments) => {
        // Remove duplicates by using a Set to store unique departments
        const uniqueDepartments = new Set(departments.map((department) => department.departamento));
        this.departmentsSubject.next([...uniqueDepartments]);
      },
      (error) => {
        console.error('Error fetching departments:', error);
      }
    );
  }

  getCitiesByDepartment(departmentId: string): Observable<any[]> {
    if (departmentId) {
      const params = { departamento: departmentId };
      return this.http.get<any[]>(this.apiUrl, { params }).pipe(
        map((cities) => {
          // Extract city names (municipios) and emit as an array of strings
          return cities.map((city) => city.municipio); // Modify "ciudad" to "municipio"
        })
      );
    } else {
      // If no department selected, emit an empty array of cities
      return this.citiesSubject.pipe(map(() => []));
    }
  }
}


/* src\app\components\services\payment\mercadopago.service.ts */

import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class MercadopagoService {

  constructor() { }
}


/* src\app\components\services\product\image-index.mixin.ts */

// image-index.mixin.ts

export interface ImageIndexMixin {
    currentImageIndex: number;
  }

/* src\app\components\services\product.service.ts */

import { initializeApp } from 'firebase/app';
import { Injectable } from '@angular/core';
import { map, Observable, from } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Product } from '../../models/product.model';
import {
  collection,
  CollectionReference,
  deleteDoc,
  doc,
  DocumentData,
  getDoc,
  getDocs,
  getFirestore,
  limit,
  orderBy,
  query,
  QuerySnapshot,
  setDoc,
  updateDoc,
  where,
} from 'firebase/firestore';
import { environment } from 'src/environments/environment';
import { CsvParserService } from '../../services/csv-parser.service';
import { CsvWriterService } from '../../services/csv-writer.service';
import { Subject } from 'rxjs';
import { Brand } from 'src/app/models/brand.model';

@Injectable({
  providedIn: 'root',
})
export class ProductService {
  getProduct(productId: any) {
    throw new Error('Method not implemented.');
  }
  private firestore: any;
  private collectionRef: CollectionReference<DocumentData>;
  private addToCartSubject: Subject<Product> = new Subject<Product>();
  addToCart$: Observable<Product> = this.addToCartSubject.asObservable();

  addProductToCart(product: Product) {
    this.addToCartSubject.next(product);
  }

  constructor(private csvParserService: CsvParserService) {
    const app = initializeApp(environment.firebase);
    const firestore = getFirestore(app);
    this.collectionRef = collection(firestore, 'productos');

    const file = new File([''], 'products.csv'); // Crear objeto File vacío con el nombre del archivo
    this.csvParserService.importProductsFromCSV(file);
  }

  getProducts(): Observable<Product[]> {
    const productsQuery = query(this.collectionRef, orderBy('name'));
    return from(getDocs(productsQuery)).pipe(
      map((querySnapshot: QuerySnapshot<DocumentData>) =>
        querySnapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data() as Product,
        }))
      )
    );
  }

  getProductById(id: string): Observable<Product> {
    const productDocRef = doc(this.collectionRef, id);
    return new Observable((observer) => {
      getDoc(productDocRef)
        .then((productDoc: DocumentData) => {
          if (productDoc['exists']()) {
            const product = productDoc['data']() as Product;
            product.id = productDoc['id'];
            observer.next(product);
          } else {
            observer.error('Product not found');
          }
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  createProduct(product: Product): Observable<Product> {
    const id = this.firestore.createId();
    product.id = id;
    return new Observable((observer) => {
      setDoc(doc(this.collectionRef, product.id), product)
        .then(() => {
          const newProduct = { ...product };
          observer.next(newProduct);
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  updateProduct(product: Product): Observable<void> {
    const productDocRef = doc(this.collectionRef, product.id);
    return new Observable((observer) => {
      updateDoc(productDocRef, product as any)
        .then(() => {
          observer.next();
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  deleteProduct(id: string): Observable<void> {
    const productDocRef = doc(this.collectionRef, id);
    return new Observable((observer) => {
      deleteDoc(productDocRef)
        .then(() => {
          observer.next();
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  getBrands(): Observable<Brand[]> {
    const brandsQuery = query(collection(this.collectionRef.firestore, 'brands'), orderBy('name'));
    return from(getDocs(brandsQuery)).pipe(
      map((querySnapshot: QuerySnapshot<DocumentData>) =>
        querySnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() as Brand }))
      )
    );
  }
}


/* src\app\components\user-panel\user-auth.guard.ts */

import { Injectable } from '@angular/core';
import { ActivatedRouteSnapshot, CanActivate, CanActivateChild, RouterStateSnapshot, UrlTree } from '@angular/router';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class UserAuthGuard implements CanActivate, CanActivateChild {
  canActivate(
    route: ActivatedRouteSnapshot,
    state: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    return true;
  }
  canActivateChild(
    childRoute: ActivatedRouteSnapshot,
    state: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    return true;
  }
  
}


/* src\app\components\user-panel\user-panel.component.html */

<div class="container">
  <div class="menu">
    <ul class="menu-items">
      <li class="menu-item" (click)="selectModule('profile')">Profile</li>
      <li class="menu-item" (click)="selectModule('password')">Change Password</li>
      <li class="menu-item" (click)="selectModule('orders')">Pedidos</li>
      <li class="menu-item" (click)="selectModule('addresses')">Direcciones</li>
      <li class="menu-item" (click)="selectModule('account')">Detalles de la Cuenta</li>
      <li class="menu-item" (click)="selectModule('wishlist')">Lista de Deseos</li>
      <li class="menu-item" (click)="selectModule('logout')">Salir</li>
    </ul>
  </div>

  <div class="content">
    <h2 *ngIf="selectedModule === 'profile'">User Profile</h2>
    <form *ngIf="selectedModule === 'profile'" [formGroup]="profileForm">
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" formControlName="name" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" formControlName="email" class="form-control" required>
      </div>
      <!-- Add more profile fields as needed -->
      <button type="button" class="btn btn-primary" (click)="updateProfile()">Update Profile</button>
    </form>
    <div *ngIf="selectedModule === 'profile'">
      <h4>Name: {{ profileForm.get('name')?.value }}</h4>
      <h4>Email: {{ profileForm.get('email')?.value }}</h4>
    </div>

    <h2 *ngIf="selectedModule === 'password'">Change Password</h2>
    <form *ngIf="selectedModule === 'password'" [formGroup]="passwordForm">
      <div class="form-group">
        <label for="currentPassword">Current Password</label>
        <input type="password" formControlName="currentPassword" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <input type="password" formControlName="newPassword" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <input type="password" formControlName="confirmPassword" class="form-control" required>
        <div *ngIf="passwordForm.hasError('passwordMismatch')" class="password-mismatch-error">
          Passwords do not match
        </div>
      </div>
      <button type="button" class="btn btn-primary" (click)="changePassword()">Change Password</button>
    </form>

    <h2 *ngIf="selectedModule === 'orders'">Pedidos</h2>
    <div *ngIf="selectedModule === 'orders'" class="module-content">
      <!-- Pedidos module content -->
    </div>

    <h2 *ngIf="selectedModule === 'addresses'">Direcciones</h2>
    <div *ngIf="selectedModule === 'addresses'" class="module-content">
      <!-- Direcciones module content -->
    </div>

    <h2 *ngIf="selectedModule === 'account'">Detalles de la Cuenta</h2>
    <div *ngIf="selectedModule === 'account'" class="module-content">
      <!-- Detalles de la Cuenta module content -->
    </div>

    <h2 *ngIf="selectedModule === 'wishlist'">Lista de Deseos</h2>
    <div *ngIf="selectedModule === 'wishlist'" class="module-content">
      <!-- Lista de Deseos module content -->
    </div>

    <div *ngIf="selectedModule === 'logout'" class="module-content">
      <button type="button" class="btn btn-primary" (click)="logout()">Logout</button>
    </div>
  </div>
</div>


/* src\app\components\user-panel\user-panel.component.ts */

import { Component, OnDestroy, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AuthService } from '../services/auth/auth.service';
import { MatSnackBar } from '@angular/material/snack-bar';
import { Subscription } from 'rxjs';
import firebase from 'firebase/compat/app';
import { User } from '@firebase/auth-types';

@Component({
  selector: 'app-user-panel',
  templateUrl: './user-panel.component.html',
  styleUrls: ['./user-panel.component.scss']
})
export class UserPanelComponent implements OnInit, OnDestroy {
  profileForm: FormGroup;
  passwordForm: FormGroup;
  selectedModule: string;
  currentUser: User | null;
  currentUserSubscription: Subscription;

  constructor(
    private formBuilder: FormBuilder,
    private authService: AuthService,
    private snackBar: MatSnackBar
  ) {}

  ngOnDestroy(): void {
    if (this.currentUserSubscription) {
      this.currentUserSubscription.unsubscribe();
    }
  }

  ngOnInit(): void {
    this.selectedModule = 'profile';

    this.profileForm = this.formBuilder.group({
      name: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      // Add more profile fields as needed
    });

    this.passwordForm = this.formBuilder.group(
      {
        currentPassword: ['', Validators.required],
        newPassword: ['', [Validators.required, Validators.minLength(6)]],
        confirmPassword: ['', Validators.required]
      },
      { validator: this.passwordMatchValidator }
    );

    this.currentUserSubscription = this.authService.getCurrentUser().subscribe((value: User | null) => {
      if (value) {
        this.currentUser = value;
        this.profileForm.patchValue({
          name: value.displayName || '',
          email: value.email || ''
        });
      }
    });
  }

  passwordMatchValidator(formGroup: FormGroup): void {
    const newPassword = formGroup.get('newPassword')?.value;
    const confirmPassword = formGroup.get('confirmPassword')?.value;

    if (newPassword !== confirmPassword) {
      formGroup.get('confirmPassword')?.setErrors({ passwordMismatch: true });
    } else {
      formGroup.get('confirmPassword')?.setErrors(null);
    }
  }

  selectModule(module: string): void {
    this.selectedModule = module;
  }

  updateProfile(): void {
    if (this.profileForm.valid) {
      const { name, email } = this.profileForm.value;
      this.authService.updateUserProfile(name, email)
        .subscribe(
          () => {
            this.showSuccessMessage('Profile updated successfully');
          },
          (error: any) => {
            this.showErrorMessage('Failed to update profile');
            console.error(error);
          }
        );
    }
  }

  changePassword(): void {
    if (this.passwordForm.valid) {
      const { currentPassword, newPassword } = this.passwordForm.value;
      this.authService.changeUserPassword(currentPassword, newPassword)
        .subscribe(
          () => {
            this.showSuccessMessage('Password changed successfully');
          },
          (error: any) => {
            this.showErrorMessage('Failed to change password');
            console.error(error);
          }
        );
    }
  }

  logout(): void {
    this.authService.signOut()
      .then(() => {
        // Handle successful logout
      })
      .catch((error: any) => {
        console.error('Logout error:', error);
      });
  }

  showErrorMessage(message: string): void {
    this.snackBar.open(message, 'Close', { duration: 3000 });
  }

  showSuccessMessage(message: string): void {
    this.snackBar.open(message, 'Close', { duration: 3000 });
  }
}


/* src\app\components\auth\login-form\login-form.component.html */

<!-- login-form.component.html -->
<div class="form-container">
  <h1>Formulario de Ingreso</h1>
  <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" formControlName="email">
      <div *ngIf="loginForm.get('email')?.errors?.['required']">Se requiere un Email.</div>
      <div *ngIf="loginForm.get('email')?.errors?.['email']">Formato Invalido.</div>
    </div>
    <div>
      <label for="password">Contraseña:</label>
      <input type="password" id="password" formControlName="password">
      <div *ngIf="loginForm.get('password')?.errors?.['required']">Es necesaria una Contraseña.</div>
    </div>
    <button type="submit" [disabled]="loginForm.invalid || isSubmitting">Ingresar</button>
    <hr>
    <div class="google-btn" (click)="googleLogin()" [hidden]="isSubmitting">Ingresar con Google</div>
    <div class="facebook-btn" (click)="facebookLogin()" [hidden]="isSubmitting">Ingresar con Facebook</div>
  </form>

  <div *ngIf="!isRegistrationEnabled && !isSubmitting" class="error-message">
    No se permite el inicio de sesión. Por favor, regístrate antes de iniciar sesión.
    <a (click)="redirectToRegistration()">Regístrate aquí</a>
  </div>

  <div *ngIf="isSubmitting" class="loading-message">
    Iniciando sesión...
  </div>
</div>


/* src\app\components\auth\login-form\login-form.component.ts */

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import { Router } from '@angular/router';
import firebase from 'firebase/compat/app';
import { MatSnackBar } from '@angular/material/snack-bar';
import { AuthService } from '../../services/auth/auth.service';

@Component({
  selector: 'app-login-form',
  templateUrl: './login-form.component.html',
  styleUrls: ['./login-form.component.scss']
})
export class LoginFormComponent implements OnInit {
  loginForm: FormGroup;
  isSubmitting = false;
  isRegistrationEnabled = true; // Variable para habilitar o deshabilitar el registro
  isUserRegistered = false;

  constructor(
    private fb: FormBuilder,
    private auth: AngularFireAuth,
    private router: Router,
    private snackBar: MatSnackBar,
    private authService: AuthService // Agregar el servicio AuthService
  ) {
    this.loginForm = this.fb.group({
      email: ['', [Validators.required, Validators.email]],
      password: ['', Validators.required]
    });
  }

  ngOnInit(): void {
  }

  onSubmit(): void {
    if (this.loginForm.valid && !this.isSubmitting) {
      this.isSubmitting = true;
      const { email, password } = this.loginForm.value;
      this.authenticateUser(email, password);
    }
  }

  googleLogin(): void {
    if (!this.isSubmitting) {
      this.isSubmitting = true;
      this.auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
        .then((result: any) => {
          console.log(result);
          this.redirectToUserPanel();
        })
        .catch((error: any) => {
          this.handleAuthenticationError(error);
          console.log(error)
        })
        .finally(() => {
          this.isSubmitting = false;
        });
    }
  }

  facebookLogin(): void {
    if (!this.isSubmitting) {
      this.isSubmitting = true;
      this.auth.signInWithPopup(new firebase.auth.FacebookAuthProvider())
        .then((result: any) => {
          console.log(result);
          this.redirectToUserPanel();
        })
        .catch((error: any) => {
          this.handleAuthenticationError(error);
          console.log(error)
        })
        .finally(() => {
          this.isSubmitting = false;
        });
    }
  }

  redirectToRegistration(): void {
    this.router.navigate(['/registration-form']); // Redireccionar a la página de registro
  }

  private authenticateUser(email: string, password: string): void {
    this.auth.signInWithEmailAndPassword(email, password)
      .then((result: any) => {
        console.log(result);
        if (result.user.metadata.creationTime === result.user.metadata.lastSignInTime) {
          // El usuario es nuevo, mostrar mensaje de error
          this.isUserRegistered = false;
          this.showUserNotRegisteredError();
        } else {
          // El usuario existe, redirigir al panel de usuario
          this.redirectToUserPanel();
        }
      })
      .catch((error: any) => {
        if (error.code === 'auth/user-not-found') {
          // Usuario no registrado, mostrar mensaje de error
          this.isUserRegistered = false;
          this.showUserNotRegisteredError();
          console.log(error)
        } else {
          this.handleAuthenticationError(error);
        }
      })
      .finally(() => {
        this.isSubmitting = false;
      });
  }

  private showUserNotRegisteredError(): void {
    this.snackBar.open('El usuario no está registrado. Regístrate antes de iniciar sesión.', 'Cerrar', { duration: 3000 });
    this.redirectToRegistration(); // Redireccionar a la página de registro
  }

  private redirectToUserPanel(): void {
    this.router.navigate(['/user-panel']); // Redireccionar al panel de usuario después de iniciar sesión
  }

  private handleAuthenticationError(error: any): void {
    if (error.code === 'auth/popup-closed-by-user') {
      console.log('Autenticación cancelada por el usuario');
    } else if (error.code === 'auth/wrong-password') {
      console.log('Contraseña incorrecta');
      this.snackBar.open('Contraseña incorrecta. Por favor, verifica tus credenciales.', 'Cerrar', { duration: 3000 });
    } else {
      console.error(error);
      this.snackBar.open('Error en el inicio de sesión', 'Cerrar', { duration: 3000 });
    }
  }
}


/* src\app\components\auth\registration-form\registration-form.component.html */

<div class="form-container">
  <h1>Formulario de Registro</h1>
  <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
    <div>
      <label for="firstName">Nombres:</label>
      <input type="text" id="firstName" formControlName="firstName">
      <div *ngIf="registrationForm.get('firstName')?.invalid && registrationForm.get('firstName')?.touched">
        <div *ngIf="registrationForm.get('firstName')?.errors?.['required']">Es necesario un Nombre.</div>
      </div>
    </div>

    <div>
      <label for="lastName">Apellidos:</label>
      <input type="text" id="lastName" formControlName="lastName">
      <div *ngIf="registrationForm.get('lastName')?.invalid && registrationForm.get('lastName')?.touched">
        <div *ngIf="registrationForm.get('lastName')?.errors?.['required']">Es necesario un Apellido.</div>
      </div>
    </div>

    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" formControlName="email">
      <div *ngIf="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched">
        <div *ngIf="registrationForm.get('email')?.errors?.['email']">Formato inválido.</div>   
        <div *ngIf="registrationForm.get('email')?.errors?.['required']">Es necesario un Email.</div>
      </div>
    </div>

    <div>
      <label for="password">Contraseña:</label>
      <input type="password" id="password" formControlName="password">
      <div *ngIf="registrationForm.get('password')?.invalid && registrationForm.get('password')?.touched">
        <div *ngIf="registrationForm.get('password')?.errors?.['required']">Es necesaria una Contraseña.</div>
      </div>
    </div>

    <button type="submit" [disabled]="registrationForm.invalid">Enviar</button>

    <hr>

    <div>
      <button class="google-btn" (click)="registerWithGoogle()">Registrar con Google</button>
      <button class="facebook-btn" (click)="registerWithFacebook()">Registrar con Facebook</button>
    </div>
  </form>
</div>


/* src\app\components\auth\registration-form\registration-form.component.ts */

import { Component, OnInit, OnDestroy } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AuthService } from '../../services/auth/auth.service';
import { Router } from '@angular/router';
import { AngularFirestore } from '@angular/fire/compat/firestore';
import { MatSnackBar } from '@angular/material/snack-bar';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import firebase from 'firebase/compat/app';
import { User } from 'firebase/auth';

@Component({
  selector: 'app-registration-form',
  templateUrl: './registration-form.component.html',
  styleUrls: ['./registration-form.component.scss']
})
export class RegistrationFormComponent implements OnInit, OnDestroy {
  registrationForm!: FormGroup;
  isSubmitting = false;
  isPopupOpen = false;
  currentUserSubscription: any;

  constructor(
    private fb: FormBuilder,
    private authService: AuthService,
    private firestore: AngularFirestore,
    private snackBar: MatSnackBar,
    private router: Router,
    private auth: AngularFireAuth
  ) {}

  ngOnInit(): void {
    this.registrationForm = this.fb.group({
      firstName: ['', Validators.required],
      lastName: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      password: ['', [Validators.required, Validators.minLength(6)]]
    });
    this.currentUserSubscription = this.authService.getCurrentUser().subscribe(() => {
      // handle current user value
    });
  }

  ngOnDestroy(): void {
    this.currentUserSubscription.unsubscribe();
  }

  isEmailValid(email: string): boolean {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  async onSubmit(): Promise<void> {
    const { firstName, lastName, email, password } = this.registrationForm.value;

    if (this.registrationForm.controls['email'].invalid || !this.isEmailValid(email)) {
      console.log('Invalid email format');
      return;
    }

    try {
      // Verificar si el correo electrónico ya existe en la base de datos
      const querySnapshot = await this.firestore
        .collection('users', (ref) => ref.where('email', '==', email))
        .get()
        .toPromise();

      if (!querySnapshot?.empty) {
        console.log('Correo Electronico Ya Existe');
        // Mostrar mensaje de error
        this.snackBar.open('Correo Electronico Ya Existe', 'Cerrar', { duration: 5000 });
        return;
      }

      // Si el correo electrónico no existe, crear el usuario
      const userCredential = await this.authService.signUpWithEmailAndPassword(email, password).toPromise();
      if (userCredential?.user) {
        console.log('User created:', userCredential.user);
        // Agregar al usuario a Firestore
        const userRef = this.firestore.collection('users').doc(userCredential.user.uid);
        await userRef.set({
          firstName,
          lastName,
          email,
        });
        console.log('User added to Firestore:', userCredential.user);
        // Redirigir al panel de usuario
        this.router.navigate(['/user-panel']);
      }
    } catch (error) {
      console.log('Error creating user:', error);
    }
  }

  verifyAndRegisterWithExternalProvider(email: string, uid: string, displayName: string | null, photoURL: string | null): void {
    // Verificar si el correo electrónico ya existe en la base de datos
    this.firestore
      .collection('users', (ref) => ref.where('email', '==', email))
      .get()
      .toPromise()
      .then((querySnapshot) => {
        if (!querySnapshot?.empty) {
          console.log('Correo Electronico Ya Existe');
          // Mostrar mensaje de error
          this.snackBar.open('Correo Electronico Ya Existe', 'Cerrar', { duration: 5000 });
          return;
        }

        // Si el correo electrónico no existe, crear el usuario con el proveedor externo
        const [firstName, lastName] = (displayName || '').split(' ');
        const userRef = this.firestore.collection('users').doc(uid);
        userRef
          .set({
            firstName,
            lastName,
            email,
            password: null, // Agregar la contraseña como null al documento del usuario en Firestore
            photoURL: photoURL || '' // Agregar la foto de perfil al documento del usuario en Firestore, o cadena vacía si es null
          })
          .then(() => {
            console.log('Usuario Creado', uid);
            this.snackBar.open('Usuario Creado', 'Cerrar', { duration: 5000 });
            // Redirigir al panel de usuario
            this.router.navigate(['/user-panel']);
          })
          .catch((error) => {
            console.log('Error Creando Usuario', error);
            this.snackBar.open('Error Creando Usuario', 'Cerrar', { duration: 5000 });
          });
      })
      .catch((error) => {
        console.log('Error checking email existence:', error);
        this.snackBar.open('Error al Verificar Email', 'Cerrar', { duration: 5000 });
      });
  }

  registerWithGoogle(): void {
    if (this.isPopupOpen) {
      return;
    }

    this.isPopupOpen = true;

    this.auth
      .signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then((result: firebase.auth.UserCredential) => {
        const credential = result?.credential;
        if (credential) {
          const user = result.user;
          if (user) {
            const email = user.email ?? '';
            const photoURL = user.photoURL ?? '';
            const displayName = user.displayName ?? '';
            this.verifyAndRegisterWithExternalProvider(email, user.uid, displayName, photoURL);
          }
        }
      })
      .catch((error) => {
        this.snackBar.open('Error al registrar con Google', 'Cerrar', { duration: 5000 });
        console.log('Error registering with Google:', error);
      })
      .finally(() => {
        this.isPopupOpen = false;
      });
  }

  registerWithFacebook(): void {
    if (this.isPopupOpen) {
      return;
    }

    this.isPopupOpen = true;

    this.auth
      .signInWithPopup(new firebase.auth.FacebookAuthProvider())
      .then((result: firebase.auth.UserCredential) => {
        const credential = result?.credential;
        if (credential) {
          const user = result.user;
          if (user) {
            const email = user.email ?? '';
            const photoURL = user.photoURL ?? '';
            const displayName = user.displayName ?? '';
            this.verifyAndRegisterWithExternalProvider(email, user.uid, displayName, photoURL);
          }
        }
      })
      .catch((error) => {
        this.snackBar.open('Error al registrar con Facebook', 'Cerrar', { duration: 5000 });
        console.log('Error registering with Facebook:', error);
      })
      .finally(() => {
        this.isPopupOpen = false;
      });
  }
}


/* src\app\components\cart\cart.component.html */

<div class="cart">
  <h2>Carrito de compras</h2>
  <div *ngIf="products.length > 0; else emptyCart">
    <div class="products">
      <div *ngFor="let product of products">
        <img [src]="product.imageUrl[0]" alt="{{ product.name }}">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description }}</p>
        <p>Tamaño: {{ product.size }}</p>
        <p>Sabor: {{ getSelectedFlavor(product) }}</p>
        <p>Precio: ${{ formatPrice(product.price) }}</p>
        <button (click)="removeProduct(product)">Eliminar</button>
      </div>
    </div>
    <div class="total">
      <p>Total: ${{ getTotal() | number }}</p>
      <button (click)="completePurchase()">Finalizar Pago</button>
    </div>
  </div>

  <ng-template #emptyCart>
    <p>Tu carrito de compras está vacío.</p>
  </ng-template>
</div>


/* src\app\components\cart\cart.component.ts */

import { Component, OnInit } from '@angular/core';
import { CartService } from '../services/cart.service';
import { Product } from '../../models/product.model';
import { MatSnackBar } from '@angular/material/snack-bar';
import { Router } from '@angular/router';

@Component({
  selector: 'app-cart',
  templateUrl: './cart.component.html',
  styleUrls: ['./cart.component.scss']
})
export class CartComponent implements OnInit {
  products: Product[] = [];

  constructor(private cartService: CartService, private snackBar: MatSnackBar, private router: Router) { }

  ngOnInit(): void {
    this.products = this.cartService.getProducts();
  }

  getTotal(): number {
    return this.products.reduce((acc, product) => acc + product.price, 0);
  }

  removeProduct(product: Product): void {
    this.cartService.removeProduct(product);
    this.products = this.cartService.getProducts();
  }

  getSelectedSize(product: Product): string {
    return product.selectedSize ? product.selectedSize : 'N/A';
  }
  
  getSelectedFlavor(product: Product): string {
    return product.selectedFlavor ? product.selectedFlavor : 'N/A';
  }

  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  completePurchase(): void {

    const isSuccess = true; // Indica si la compra se ha completado con éxito
  
    if (isSuccess) {
      // Redirigir a la página de checkout
      this.router.navigate(['/checkout']);
    } else {
      // Mostrar mensaje de error
      this.snackBar.open('Ha ocurrido un error al completar la compra. Por favor, inténtalo de nuevo.', 'Cerrar', { duration: 3000 });
    }
  }  
}

/* src\app\components\checkout\checkout.component.html */

<div class="checkout-container">
  <div class="checkout-form">
    <h2>Checkout</h2>
    <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="numero_documento">Número de documento:</label>
        <input type="number" id="numero_documento" formControlName="numero_documento" required>
      </div>
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" formControlName="email" required>
      </div>
      <div class="form-group">
        <label for="nombres">Nombres:</label>
        <input type="text" id="nombres" formControlName="nombres" required>
      </div>
      <div class="form-group">
        <label for="apellidos">Apellidos:</label>
        <input type="text" id="apellidos" formControlName="apellidos" required>
      </div>
      <div class="form-group">
        <label for="departamento">Departamento:</label>
        <select id="departamento" formControlName="departamento" required (change)="onDepartmentChange(checkoutForm.value.departamento)">
          <option value="" disabled selected>Seleccione un departamento</option>
          <option *ngFor="let department of departments" [value]="department">{{ department }}</option>
        </select>
      </div>
  
      <div class="form-group">
        <label for="ciudad">Ciudad:</label>
        <select id="ciudad" formControlName="ciudad" required>
          <option value="" disabled selected>Seleccione una ciudad</option>
          <ng-container *ngFor="let ciudad of cities">
            <option [value]="ciudad">{{ ciudad }}</option>
          </ng-container>
        </select>
      </div>
      <div class="form-group">
        <label for="direccion_envio">Dirección de envío:</label>
        <input type="text" id="direccion_envio" formControlName="direccion_envio" required>
      </div>
      <div class="form-group">
        <label for="complemento">Complemento:</label>
        <input type="text" id="complemento" formControlName="complemento">
      </div>
      <div class="form-group">
        <label for="celular">Celular:</label>
        <input type="number" id="celular" formControlName="celular" required>
      </div>
      <div class="form-group">
        <label for="notas">Notas:</label>
        <textarea id="notas" formControlName="notas"></textarea>
      </div>
      <button type="submit" [disabled]="checkoutForm.invalid">Realizar pedido</button>
    </form>
  </div>

  <div class="payment-summary">
    <h2>Resumen de pedido</h2>
    <div *ngFor="let product of products" class="product-item">
      <img [src]="product.imageUrl[0]" alt="{{ product.name }}">
      <div class="product-details">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description }}</p>
        <p>Tamaño: {{ product.size }}</p>
        <p>Sabor: {{ getSelectedFlavor(product) }}</p>
        <p>Precio: ${{ formatPrice(product.price) }}</p>
      </div>
      <button (click)="removeProduct(product)">Eliminar</button>
    </div>
    <div class="total">
      <p>Total: ${{ getTotal() | number }}</p>
    </div>
    <div class="payment-options">
      <h3>Seleccione el método de pago</h3>
      <div>
      <!--  <p><button (click)="makeMercadoPagoPayment()">Pagar con MercadoPago</button></p> -->
      <!--  <p><button (click)="makePSEPayment()">Pagar con PSE</button></p> -->
      </div>
    </div>
  </div>
</div>


/* src\app\components\checkout\checkout.component.ts */

import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AngularFirestore } from '@angular/fire/compat/firestore';
import { Router } from '@angular/router';
import { CartService } from '../services/cart.service';
import { Product } from 'src/app/models/product.model';
import { LocationService } from '../services/location.service';
import { Observable } from 'rxjs';

@Component({
  selector: 'app-checkout',
  templateUrl: './checkout.component.html',
  styleUrls: ['./checkout.component.scss']
})
export class CheckoutComponent implements OnInit {
  checkoutForm: FormGroup;
  products: Product[];
  total: number;
  departments: any[];
  cities: any[];

  constructor(
    private formBuilder: FormBuilder,
    private firestore: AngularFirestore,
    private cartService: CartService,
    private router: Router,
    private locationService: LocationService // Inject the LocationService
  ) {}

  ngOnInit(): void {
    this.checkoutForm = this.formBuilder.group({
      numero_documento: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      nombres: ['', Validators.required],
      apellidos: ['', Validators.required],
      departamento: ['', Validators.required],
      ciudad: ['', Validators.required],
      direccion_envio: ['', Validators.required],
      complemento: [''],
      celular: ['', Validators.required],
      notas: [''],
      fecha: ['', Validators.required],
      numero_pedido: [''],
      estado: ['']
    });

    this.products = this.cartService.getProducts();
    this.total = this.cartService.getTotal();

    // Fetch departments from the LocationService
    this.locationService.departments$.subscribe((departments) => {
      this.departments = departments;
    });

    // Initialize the cities array with an empty array
    this.cities = [];

    // Subscribe to changes in the selected department
    this.checkoutForm.get('departamento')?.valueChanges.subscribe((departmentId) => {
      if (departmentId) {
        // Fetch cities by department from the LocationService
        this.locationService.getCitiesByDepartment(departmentId).subscribe((cities) => {
          this.cities = cities;
        });
      } else {
        // If no department selected, reset the cities array
        this.cities = [];
      }
    });
  }

  onDepartmentChange(departmentId: string): void {
    if (departmentId) {
      // Fetch cities by department from the LocationService
      this.locationService.getCitiesByDepartment(departmentId).subscribe((cities: any[]) => {
        this.cities = cities;
      });
    } else {
      this.cities = [];
    }
  }

  onSubmit(): void {
    if (this.checkoutForm.invalid) {
      return;
    }

    const pedido = {
      numero_documento: this.checkoutForm.value.numero_documento,
      email: this.checkoutForm.value.email,
      nombres: this.checkoutForm.value.nombres,
      apellidos: this.checkoutForm.value.apellidos,
      departamento: this.checkoutForm.value.departamento,
      ciudad: this.checkoutForm.value.ciudad,
      direccion_envio: this.checkoutForm.value.direccion_envio,
      complemento: this.checkoutForm.value.complemento,
      celular: this.checkoutForm.value.celular,
      notas: this.checkoutForm.value.notas,
      fecha: this.checkoutForm.value.fecha,
      numero_pedido: '', // Se generará automáticamente en Firestore
      estado: '' // Se establecerá automáticamente en Firestore
    };

    this.firestore
      .collection('pedidos')
      .add(pedido)
      .then((docRef: { id: any; }) => {
        const numeroPedido = docRef.id;
        this.firestore
          .collection('pedidos')
          .doc(numeroPedido)
          .update({
            numero_pedido: numeroPedido,
            estado: 'pendiente'
          })
          .then(() => {
            console.log('Pedido guardado exitosamente.');
            // Aquí puedes redirigir al usuario a la página de éxito del pedido
          })
          .catch((error: any) => {
            console.error('Error al actualizar el número de pedido y estado:', error);
          });
      })
      .catch((error: any) => {
        console.error('Error al guardar el pedido:', error);
      });
  }

  getSelectedFlavor(product: Product): string {
    return product.selectedFlavor ? product.selectedFlavor : 'N/A';
  }
  
  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  removeProduct(product: Product): void {
    this.cartService.removeProduct(product);
    this.products = this.cartService.getProducts();
    this.total = this.cartService.getTotal();
  }

  getTotal(): number {
    return this.total;
  }
}

/* src\app\components\contact\contact.component.html */

<div class="container">
  <h1>Contáctanos</h1>
  <div class="row">
    <div class="col-md-6">
      <h3>Ubicación</h3>
      <p>Estamos ubicados en Bogotá y Hacemos envios a todo el pais¡.</p>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3976.062868153577!2d-74.0646823842646!3d4.697542342809965!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e3f8a84ce4b3719%3A0xeb13a526a824c6b4!2sBogot%C3%A1%2C%20Colombia!5e0!3m2!1sen!2sus!4v1620354656928!5m2!1sen!2sus" width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    </div>
    <div class="col-md-6">
      <h3>Contáctanos</h3>
      <form>
        <div class="form-group">
          <label for="name">Nombre</label>
          <input type="text" class="form-control" id="name" placeholder="Ingresa tu nombre">
        </div>
        <div class="form-group">
          <label for="email">Correo electrónico</label>
          <input type="email" class="form-control" id="email" placeholder="Ingresa tu correo electrónico">
        </div>
        <div class="form-group">
          <label for="message">Mensaje</label>
          <textarea class="form-control" id="message" rows="5" placeholder="Ingresa tu mensaje"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Enviar mensaje</button>
      </form>
      <div class="mt-4">
        <p>También puedes contactarnos por:</p>
        <ul>
          <li><a href="tel:+573124193753"><i class="fa fa-phone mr-2"></i>+57 3124193753</a></li>
          <li><a href="https://wa.me/573124193753"><i class="fa fa-whatsapp mr-2"></i>+57 3124193753</a></li>
          <li><a href="mailto:contacto@tutiendafit.com"><i class="fa fa-envelope mr-2"></i>contacto@tutiendafit.com</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


/* src\app\components\contact\contact.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-contact',
  templateUrl: './contact.component.html',
  styleUrls: ['./contact.component.scss']
})
export class ContactComponent {

}


/* src\app\components\home\home.component.html */

<main>
  <section class="py-5 bg-light">
    <div class="container">
      <h1 class="text-center mb-5">Bienvenido a PowerFitness</h1>

      <!-- Agregar el slider aquí -->
      <div class="carousel-container">
        <ngx-slick-carousel class="carousel" [config]="carouselConfig">
          <div *ngFor="let brand of brands" class="carousel-item">
            <img [src]="brand.image[0]" alt="{{ brand.brand }}" class="brand-logo">
          </div>
        </ngx-slick-carousel>
      </div>

      <h1 class="text-center mb-5">Productos en Oferta</h1>
      <div class="row">
        <div *ngFor="let product of products" class="col-md-4 col-sm-6 mb-4">
          <div class="card shadow-sm">
            <img class="card-img-top" [src]="product.imageUrl" alt="{{ product.name }}">
            <div class="card-body">
              <h4 class="card-title">{{ product.name }}</h4>
              <p class="card-text">{{ product.description }}</p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-outline-secondary">Ver más</button>
                  <button type="button" class="btn btn-sm btn-outline-secondary">Comprar</button>
                </div>
                <small class="text-muted">${{ formatPriceWithThousandsSeparator(product.price) }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>


/* src\app\components\home\home.component.ts */

import { Component, OnInit, ViewChild } from '@angular/core';
import { ProductService } from '../services/product.service';
import { BrandService } from '../services/brand/brand.service';
import { Product } from '../../models/product.model';
import { Brand } from '../../models/brand.model';
import { SlickCarouselComponent } from 'ngx-slick-carousel';
import { DecimalPipe } from '@angular/common';

@Component({
  selector: 'app-home',
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.scss']
})
export class HomeComponent implements OnInit {
  @ViewChild('slickModal', { static: true }) slickModal: SlickCarouselComponent;

  products: Product[] = [];
  brands: Brand[];

  carouselConfig: any = {
    slidesToShow: 4,
    slidesToScroll: 1,
    dots: true,
    arrows: true,
    autoplay: true,
    autoplaySpeed: 3000,
    infinite: true
  };

  constructor(
    private productService: ProductService,
    private brandService: BrandService,
    private decimalPipe: DecimalPipe
  ) {}

  ngOnInit() {
    this.productService.getProducts().subscribe((products: Product[]) => {
      // Obtener 6 productos aleatorios
      this.products = this.getRandomProducts(products, 6);
    });

    this.brandService.getBrands().subscribe((brands: Brand[]) => {
      this.brands = brands;
      this.updateCarousel();
    });
  }

  // Función para obtener productos aleatorios
  private getRandomProducts(products: Product[], count: number): Product[] {
    const randomProducts: Product[] = [];
    const totalProducts = products.length;

    if (totalProducts <= count) {
      return products;
    }

    const selectedIndices: number[] = [];

    while (randomProducts.length < count) {
      const randomIndex = Math.floor(Math.random() * totalProducts);

      if (!selectedIndices.includes(randomIndex)) {
        selectedIndices.push(randomIndex);
        randomProducts.push(products[randomIndex]);
      }
    }

    return randomProducts;
  }

  updateCarousel() {
    // Actualizar el número de slidesToShow del carrusel
    // según el número de marcas disponibles
    const numBrands = this.brands.length;
    this.carouselConfig.slidesToShow = Math.min(numBrands, 5);

    // Reiniciar el carrusel para reflejar los cambios
    if (this.slickModal) {
      this.slickModal.unslick();
      this.slickModal.initSlick();
    }
  }

  formatPriceWithThousandsSeparator(price: number | null): string {
    if (price == null) return '';
  
    // Usar toLocaleString para agregar separadores de miles
    const formattedPrice = price.toLocaleString(undefined, { minimumFractionDigits: 0 });
  
    // Reemplazar la coma por un punto
    return formattedPrice.replace(',', '.');
  }
}


/* src\app\components\layout\footer\footer.component.html */

<footer class="bg-dark text-white py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5>PowerFitness</h5>
          <p>Tienda de artículos deportivos en Bogotá, Colombia. Envíos a todo el país.</p>
          <p>Teléfono: +573124193753</p>
        </div>
        <div class="col-md-4">
          <h5>Enlaces</h5>
          <ul class="list-unstyled">
            <li><a href="#">Inicio</a></li>
            <li><a href="#">Categorías</a></li>
            <li><a href="#">Productos</a></li>
            <li><a href="#">Nosotros</a></li>
            <li><a href="#">Descuentos</a></li>
            <li><a href="#">Contacto</a></li>
          </ul>
        </div>
        <div class="col-md-4">
          <h5>Síguenos</h5>
          <ul class="list-unstyled">
            <li><a href="#">Facebook</a></li>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">Instagram</a></li>
          </ul>
        </div>
      </div>
      <hr>
      <p class="text-muted small mb-0">© 2023 PowerFitness</p>
    </div>
  </footer>
  

/* src\app\components\layout\footer\footer.component.ts */

import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-footer',
  templateUrl: './footer.component.html',
  styleUrls: ['./footer.component.scss']
})
export class FooterComponent implements OnInit {

  constructor() { }

  ngOnInit(): void {
  }

}


/* src\app\components\layout\header\header.component.html */



/* src\app\components\layout\header\header.component.ts */

import { Component, OnInit } from '@angular/core';
import { NavbarComponent } from '../../navbar/navbar.component';

@Component({
  selector: 'app-header',
  templateUrl: './header.component.html',
  styleUrls: ['./header.component.scss']
})
export class HeaderComponent implements OnInit {

  constructor() { }

  ngOnInit(): void {
  }

}


/* src\app\components\logout\logout.component.html */

<p>logout works!</p>


/* src\app\components\logout\logout.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-logout',
  templateUrl: './logout.component.html',
  styleUrls: ['./logout.component.scss']
})
export class LogoutComponent {

}


/* src\app\components\navbar\navbar.component.html */

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" routerLink="/">PowerFitness</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" routerLink="/home" routerLinkActive="active">Inicio</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" routerLink="/categorias" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Categorías
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              <li><a class="dropdown-item" href="#">Proteínas</a></li>
              <li><a class="dropdown-item" href="#">Pre-entrenamientos</a></li>
              <li><a class="dropdown-item" href="#">Quemadores de grasa</a></li>
              <li><a class="dropdown-item" href="#">Vitaminas y minerales</a></li>
              <li><a class="dropdown-item" href="#">Accesorios de entrenamiento</a></li>
              <li><a class="dropdown-item" href="#">Ropa deportiva</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/product-list" routerLinkActive="active">Productos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/nosotros" routerLinkActive="active">Nosotros</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/sale" routerLinkActive="active">Ofertas!</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/contact" routerLinkActive="active">Contacto</a>
          </li>
        </ul>
        <form class="d-flex" (ngSubmit)="searchForm.ngSubmit.emit()">
          <input class="form-control me-2" type="search" placeholder="Buscar" aria-label="Buscar" [(ngModel)]="searchQuery" name="searchQuery">
          <button class="btn btn-outline-success" type="submit">Buscar</button>
        </form>
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" routerLink="/login-form" routerLinkActive="active">Iniciar Sesión</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/register" routerLinkActive="active">Registro</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" routerLink="/cart" routerLinkActive="active">
              <span class="bi bi-cart"></span>
              <span class="cart-items">{{ cartItemCount }}</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


/* src\app\components\navbar\navbar.component.ts */

import { Component, ViewChild, OnInit } from '@angular/core';
import { NgForm } from '@angular/forms';
import { CartService } from '../services/cart.service';
import { ProductService } from '../services/product.service';

@Component({
  selector: 'app-navbar',
  templateUrl: './navbar.component.html',
  styleUrls: ['./navbar.component.scss']
})

export class NavbarComponent implements OnInit {
  @ViewChild('searchForm') searchForm: NgForm;
  searchQuery: string;

  cartItemCount: number = 0;  // Variable para almacenar el número de elementos en el carrito

  constructor(private productService: ProductService) {}

  ngOnInit() {
    this.productService.addToCart$.subscribe(() => {
      this.cartItemCount++;
    });
  }

  // ...
}

/* src\app\components\nosotros\nosotros.component.html */

<section class="nosotros">
  <div class="container">
    <h2 class="nosotros-title">Bienvenidos a PowerFitness</h2>
    <p class="nosotros-description">
      En nuestro compromiso por ayudarte a alcanzar tus objetivos de manera eficiente y segura, te ofrecemos una amplia variedad de productos y servicios especializados en el ámbito deportivo.
    </p>
    <p class="nosotros-description">
    Nos especializamos en la venta de  suplementos deportivos de alta calidad, entre los que destacan nuestra selección de proteínas, pre-entrenamientos, quemadores de grasa, vitaminas y minerales, así como accesorios de entrenamiento y ropa deportiva.
    Contamos con las mejores marcas del mercado para garantizarte los resultados que esperas, sin comprometer tu salud ni seguridad. Todos nuestros productos son seleccionados cuidadosamente y sometidos a rigurosos controles de calidad para garantizar que cumplen con los estándares más exigentes.
    </p>
    <p class="nosotros-description">
      Además, en PowerFitness no solo te ofrecemos productos de calidad, sino también asesoramiento personalizado para que puedas elegir los suplementos deportivos que mejor se adapten a tus necesidades y objetivos. Nos enfocamos en entender tus necesidades específicas para ofrecerte recomendaciones personalizadas y así puedas alcanzar tus metas de forma más efectiva.
    </p>
    <p class="nosotros-description">
      En definitiva, en PowerFitness estamos comprometidos en ser tu aliado en el camino hacia una vida más saludable y activa, ofreciéndote siempre los mejores productos y servicios para que puedas alcanzar tus metas de forma eficiente y segura. No dudes en visitar nuestra tienda virtual y comprobar por ti mismo la calidad de nuestra oferta.
    </p>
    <a class="nosotros-button" href="product-list">Explora nuestros productos</a>
  </div>
</section>


/* src\app\components\nosotros\nosotros.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-nosotros',
  templateUrl: './nosotros.component.html',
  styleUrls: ['./nosotros.component.scss']
})
export class NosotrosComponent {

}


/* src\app\components\product-import\product-import.component.html */

<div>
    <h1>Product Import</h1>
    <input type="file" #fileInput (change)="handleFileInput(fileInput)">
    <button (click)="importCSV()"> Import CSV </button>
  </div>

/* src\app\components\product-import\product-import.component.ts */

import { Component } from '@angular/core';
import { CsvParserService } from '../../services/csv-parser.service';

@Component({
  selector: 'app-product-import',
  templateUrl: './product-import.component.html',
  styleUrls: ['./product-import.component.scss']
})
export class ProductImportComponent {
  file: File;

  constructor(private csvParserService: CsvParserService) {}

  handleFileInput(input: HTMLInputElement): void {
    const files = input.files;
    if (files && files.length > 0) {
      this.file = files[0];
    }
  }

  importCSV(): void {
    if (this.file) {
      this.csvParserService.importProductsFromCSV(this.file);
    }
  }
}


/* src\app\components\product-management\product-management.component.html */

<div>
  <h1>Product Management</h1>
  <input type="file" #fileInput (change)="handleFileInput(fileInput)">
  <button (click)="exportToCSV()">Exportar CSV</button>
</div>


/* src\app\components\product-management\product-management.component.ts */

import { Component } from '@angular/core';
import { CsvWriterService } from '../../services/csv-writer.service';
import { ProductService } from '../services/product.service';
import { Product } from '../../models/product.model';

@Component({
  selector: 'app-product-management',
  templateUrl: './product-management.component.html',
  styleUrls: ['./product-management.component.scss']
})
export class ProductManagementComponent {
  file: File;

  constructor(
    private csvWriterService: CsvWriterService,
    private productService: ProductService
  ) {}

  handleFileInput(input: HTMLInputElement): void {
    const files = input.files;
    if (files && files.length > 0) {
      this.file = files[0];
    }
  }

  exportToCSV(): void {
    this.productService.getProducts().subscribe((products: Product[]) => {
      this.csvWriterService.generateCSV(products);
    });
  }
}


/* src\app\components\products\product\product.component.html */

<p>product works!</p>


/* src\app\components\products\product\product.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-product',
  templateUrl: './product.component.html',
  styleUrls: ['./product.component.scss']
})
export class ProductComponent {

}


/* src\app\components\products\product-detail\product-detail.component.html */

<!-- product-detail.component.html -->
<div class="container" *ngIf="product">
    <div class="row">
      <div class="col-12">
        <div class="card product">
          <div class="image-wrapper">
            <div class="image-container">
              <button class="arrow left-arrow" (click)="setCurrentImageIndex(currentImageIndex - 1)">&lt;</button>
              <div class="images">
                <img class="card-img-top product-image" [src]="product.imageUrl || ''" alt="{{ product.name }}" />
              </div>
              <button class="arrow right-arrow" (click)="setCurrentImageIndex(currentImageIndex + 1)">&gt;</button>
            </div>
          </div>
          <div class="card-body">
            <h5 class="card-title product-name">{{ product.name }}</h5>
            <p class="card-text product-category" *ngIf="product?.category?.length">
              Categoría: {{ product.category }}
            </p>
            <p class="card-text product-brand" *ngIf="product?.brand?.length">Marca: {{ product.brand }}</p>
            <p class="card-text product-size" *ngIf="product?.sizes?.length">
              Tamaño:
              <select [(ngModel)]="product.selectedSize" (change)="filterProductsBySize()">
                <option *ngFor="let size of product.sizes" [value]="size">{{ size }}</option>
              </select>
            </p>
            <p class="card-text product-size" *ngIf="product?.size?.length">Tamaño: {{ product.size }}</p>
            <p class="card-text product-flavor" *ngIf="product?.flavors?.length">
              Sabor:
              <select [(ngModel)]="product.selectedFlavor" (change)="filterProductsByFlavor()">
                <option *ngFor="let flavor of product.flavors" [value]="flavor">{{ flavor }}</option>
              </select>
            </p>
            <p class="card-text product-flavor" *ngIf="product?.flavors?.length === 1">Sabor: {{ product.flavors[0] }}</p>
            <p class="card-text product-stock" *ngIf="product?.stock !== undefined && product.stock !== 0">
              Stock: {{ product.stock }}
            </p>
            <p class="card-text product-description" *ngIf="product?.description">{{ product.description }}</p>
            <p class="card-text product-discount" *ngIf="product?.discount !== undefined && product.discount !== 0">
              Descuento: {{ product.discount }}
            </p>
            <p class="card-text product-price" *ngIf="product?.price !== undefined && product.price !== 0">
              {{ formatPrice(product.price || 0) }}
            </p>
            <button class="btn btn-primary add-to-cart-button" (click)="addProduct(product)">Añadir al Carrito</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  

/* src\app\components\products\product-detail\product-detail.component.ts */

import { Component, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { ProductService } from '../../services/product.service';
import { Product } from '../../../models/product.model';
import { CartService } from '../../services/cart.service';
import { Router } from '@angular/router';

@Component({
  selector: 'app-product-detail',
  templateUrl: './product-detail.component.html',
  styleUrls: ['./product-detail.component.scss'],
})
export class ProductDetailComponent implements OnInit {
  products: Product[] = [];
  selectedSize: string = '';
  selectedFlavor: string = '';
  selectedCategory: string = '';
  productCategories: string[] = [];
  productSizes: string[] = [];
  productFlavors: string[] = [];
  filteredProducts: Product[] = [];
  confirmationMessage: string = '';
  currentImageIndex: number = 0;
  product: Product | undefined;

  constructor(
    private productService: ProductService,
    private cartService: CartService,
    private route: ActivatedRoute,
    private router: Router
  ) {}

  ngOnInit() {
    const productId = this.route.snapshot.params['id'];
    this.productService.getProducts().subscribe(
      (products: Product[]) => {
        this.product = products.find(product => product.id === productId);
        if (!this.product) {
          console.error('Product not found');
        }
      },
      (error: any) => {
        console.error('Error retrieving products:', error);
      }
    );
  }  

  getProduct(): void {
    const id = this.route.snapshot.paramMap.get('id');
    if (id) {
      this.productService.getProductById(id).subscribe(
        (product: Product) => {
          if (product) {
            this.product = product;
          } else {
            console.error('Product not found');
          }
        },
        (error: any) => {
          console.error(error);
        }
      );
    }
  }
  
  setCurrentImageIndex(index: number): void {
    this.currentImageIndex = index;
  }

  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  addProduct(product: Product): void {
    if ((product.flavors && product.flavors.length > 0 && !product.selectedFlavor) || (product.sizes && product.sizes.length > 0 && !product.selectedSize)) {
      this.confirmationMessage = '';
      return;
    }
    
    const selectedProduct = { ...product };
    this.selectedSize = this.selectedSize;
    this.selectedFlavor = this.selectedFlavor;

    this.cartService.addProduct(selectedProduct);
    this.productService.addProductToCart(selectedProduct);
    this.confirmationMessage = 'Producto agregado al carrito: ' + product.name;

    this.selectedSize = '';
    this.selectedFlavor = '';
  }
  

  filterProductsBySize(): void {
    if (this.selectedSize) {
      this.filteredProducts = this.products.filter(
        (product) => product.size === this.selectedSize
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  filterProductsByFlavor(): void {
    if (this.selectedFlavor) {
      this.filteredProducts = this.products.filter(
        (product) => product.flavors.includes(this.selectedFlavor)
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  checkAvailability(product: Product): void {
    const selectedProduct = { ...product };
    if (selectedProduct.id !== undefined) {
      selectedProduct.id = selectedProduct.id.toString();
      this.productService
        .getProductById(selectedProduct.id)
        .subscribe((dbProduct: Product) => {
          // ...
        });
    } else {
      // Manejar el caso en que el ID del producto sea undefined
    }
  }
}

/* src\app\components\products\product-list\product-list.component.html */

<!-- product-list.component.html -->
<div class="container">
  <div class="row">
    <div class="col-12 col-lg-3">
      <div class="category-menu">
        <h5>Categorías:</h5>
        <ul>
          <li *ngFor="let category of productCategories" (click)="filterProductsByCategory(category)">
            {{ category }}
          </li>
        </ul>
      </div>
    </div>

    <div class="col-12 col-lg-9">
      <div class="row">
        <div *ngIf="confirmationMessage" class="confirmation-message col-12">
          {{ confirmationMessage }}
        </div>
        <div class="col-12 col-md-6 col-lg-4" *ngFor="let product of filteredProducts">
          <div class="card product">
            <div class="image-wrapper">
              <div class="image-container">
                <button class="arrow left-arrow" (click)="scrollImages(product, -1)">&lt;</button>
                <div class="images">
                  <img class="card-img-top product-image" [src]="product.imageUrl[currentImageIndex]" alt="{{ product.name }}" />
                </div>
                <button class="arrow right-arrow" (click)="scrollImages(product, 1)">&gt;</button>
              </div>
            </div>
            <div class="card-body">
              <h5 class="card-title product-name">
                <a *ngIf="product.id" (click)="viewProductDetails(product.id)" [title]="product.name">{{ product.name }}</a>
                <span *ngIf="!product.id" [title]="product.name">{{ product.name }}</span>
              </h5>
              <p class="card-text product-category" *ngIf="product.category && product.category.length > 0">
                Categoría: {{ product.category }}
              </p>
              <p class="card-text product-brand" *ngIf="product.brand && product.brand.length > 0">Marca: {{ product.brand }}</p>
              <p class="card-text product-size" *ngIf="product.sizes && product.sizes.length > 0">
                Tamaño:
                <select [(ngModel)]="product.selectedSize" (change)="filterProductsBySize()">
                  <option *ngFor="let size of product.sizes" [value]="size">{{ size }}</option>
                </select>
              </p>
              <p class="card-text product-size" *ngIf="product.size && product.size.length > 0">
                Tamaño: {{ product.size }}
              </p>
              <p class="card-text product-flavor" *ngIf="product.flavors && product.flavors.length > 0">
                Sabor:
                <select [(ngModel)]="product.selectedFlavor" (change)="filterProductsByFlavor()">
                  <option *ngFor="let flavor of product.flavors" [value]="flavor">{{ flavor }}</option>
                </select>
              </p>
              <p class="card-text product-flavor" *ngIf="product.flavors && product.flavors.length === 1">
                Sabor: {{ product.flavors[0] }}
              </p>
              <p class="card-text product-stock" *ngIf="product.stock !== undefined && product.stock !== 0">
                Stock: {{ product.stock }}
              </p>
              <p class="card-text product-description" *ngIf="product.description">{{ product.description }}</p>
              <p class="card-text product-discount" *ngIf="product.discount !== undefined && product.discount !== 0">
                Descuento: {{ product.discount }}
              </p>
              <p class="card-text product-price" *ngIf="product.price !== undefined && product.price !== 0">
               ${{ formatPrice(product.price) }}
              </p>
              <button class="btn btn-primary add-to-cart-button" (click)="addProduct(product)">Añadir al Carrito</button>
              <button class="btn btn-primary view-more-button" *ngIf="product.id" (click)="viewProductDetails(product.id)">Ver más</button>
              <p class="error-message" *ngIf="product.flavors && product.flavors.length > 0 && !product.selectedFlavor">Selecciona un sabor</p>
              <p class="error-message" *ngIf="product.sizes && product.sizes.length > 0 && !product.selectedSize">Selecciona un tamaño</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


/* src\app\components\products\product-list\product-list.component.ts */

// product-list.component.ts
import { Component, OnInit } from '@angular/core';
import { ProductService } from '../../services/product.service';
import { Product } from '../../../models/product.model';
import { CartService } from '../../services/cart.service';
import { Router } from '@angular/router';
import { ImageIndexMixin } from '../../services/product/image-index.mixin';

// Extiende el tipo Product con la interfaz ImageIndexMixin
type ProductWithImageIndex = Product & ImageIndexMixin;

@Component({
  selector: 'app-product-list',
  templateUrl: 'product-list.component.html',
  styleUrls: ['product-list.component.scss'],
})
export class ProductListComponent implements OnInit {
  products: ProductWithImageIndex[] = [];
  selectedSize: string = '';
  selectedFlavor: string = '';
  selectedCategory: string = '';
  productCategories: string[] = [];
  productSizes: string[] = [];
  productFlavors: string[] = [];
  filteredProducts: Product[] = [];
  confirmationMessage: string = '';
  currentImageIndex: number = 0;
  

  constructor(
    private productService: ProductService,
    private cartService: CartService,
    private router: Router
  ) {}

  ngOnInit() {
    this.productService.getProducts().subscribe((products: Product[]) => {
      this.products = products.map((product) => ({
        ...product,
        selectedSize: '',
        selectedFlavor: '',
      }));

      this.productCategories = Array.from(new Set(this.products.map((product) => product.category)));
      this.productSizes = Array.from(new Set(this.products.map((product) => product.size)));
      this.productFlavors = Array.from(new Set(this.products.flatMap((product) => product.flavors)));
      this.filteredProducts = [...this.products];
    });
  }

  addProduct(product: Product): void {
    if ((product.flavors && product.flavors.length > 0 && !product.selectedFlavor) || (product.sizes && product.sizes.length > 0 && !product.selectedSize)) {
      this.confirmationMessage = '';
      return;
    }
    
    const selectedProduct = { ...product };
    this.selectedSize = this.selectedSize;
    this.selectedFlavor = this.selectedFlavor;

    this.cartService.addProduct(selectedProduct);
    this.productService.addProductToCart(selectedProduct);
    this.confirmationMessage = 'Producto agregado al carrito: ' + product.name;

    this.selectedSize = '';
    this.selectedFlavor = '';
  }

  scrollImages(product: ProductWithImageIndex, direction: number): void {
    const imageUrls = product.imageUrl;
    const lastIndex = imageUrls.length - 1;
  
    // Obtén el índice actual de la imagen para este producto
    const currentImageIndex = product.currentImageIndex || 0;
  
    // Calcula el nuevo índice
    let newImageIndex = currentImageIndex + direction;
  
    if (newImageIndex > lastIndex) {
      newImageIndex = 0;
    } else if (newImageIndex < 0) {
      newImageIndex = lastIndex;
    }
  
    // Actualiza el índice de la imagen para este producto
    product.currentImageIndex = newImageIndex;
  }
  
  checkAvailability(product: Product): void {
    const selectedProduct = { ...product };
    if (selectedProduct.id !== undefined) {
      selectedProduct.id = selectedProduct.id.toString();
      this.productService
        .getProductById(selectedProduct.id)
        .subscribe((dbProduct: Product) => {
          // ...
        });
    } else {
      // Manejar el caso en que el ID del producto sea undefined
    }
  }

  filterProductsByCategory(category?: string): void {
    if (category) {
      this.selectedCategory = category;
      this.filteredProducts = this.products.filter(
        (product) => product.category === category
      );
    } else {
      this.selectedCategory = '';
      this.filteredProducts = [...this.products];
    }
  }

  filterProductsBySize(): void {
    if (this.selectedSize) {
      this.filteredProducts = this.products.filter(
        (product) => product.size === this.selectedSize
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  filterProductsByFlavor(): void {
    if (this.selectedFlavor) {
      this.filteredProducts = this.products.filter(
        (product) => product.flavors.includes(this.selectedFlavor)
      );
    } else {
      this.filteredProducts = [...this.products];
    }
  }

  formatPrice(price: number): string {
    return price.toLocaleString('es-ES');
  }

  viewProductDetails(productId: string): void {
    this.router.navigate(['/products', productId]);
  }
}


/* src\app\components\search\search.component.html */

<form class="d-flex" (ngSubmit)="searchProducts()">
    <input class="form-control me-2" type="search" placeholder="Buscar" aria-label="Buscar" [(ngModel)]="searchQuery" name="searchQuery">
    <button class="btn btn-outline-success" type="submit">Buscar</button>
  </form>
  

/* src\app\components\search\search.component.ts */

import { Component } from '@angular/core';

@Component({
  selector: 'app-search',
  templateUrl: './search.component.html',
  styleUrls: ['./search.component.scss']
})
export class SearchComponent {
  searchQuery: string;

  searchProducts(): void {
    // Aquí puedes agregar la lógica para realizar la búsqueda
    console.log('Realizando búsqueda: ' + this.searchQuery);
  }
}


/* src\app\components\services\auth\auth.service.ts */

// auth.service.ts
import { Injectable } from '@angular/core';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import { Observable, from, throwError } from 'rxjs';
import { User, UserCredential } from '@firebase/auth-types';
import firebase from 'firebase/compat/app';
import 'firebase/compat/auth';
import { AngularFirestore } from '@angular/fire/compat/firestore';
import { Subscription } from 'rxjs';
import { switchMap, take, catchError } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  logout() {
    throw new Error('Method not implemented.');
  }
  user$: Observable<User | null>;

  constructor(private afAuth: AngularFireAuth, private firestore: AngularFirestore) {
    this.user$ = this.afAuth.authState;
  }

  signUpWithEmailAndPassword(email: string, password: string): Observable<UserCredential> {
    return from(this.afAuth.createUserWithEmailAndPassword(email, password)).pipe(
      catchError((error) => {
        console.error('Error signing up:', error);
        return throwError(error);
      })
    );
  }  

  signInWithGoogle(): Observable<UserCredential> {
    const provider = new firebase.auth.GoogleAuthProvider();
    return from(this.afAuth.signInWithPopup(provider)).pipe(
      catchError((error) => {
        console.error('Error signing in with Google:', error);
        return throwError(error);
      })
    );
  }  

  signInWithFacebook(): Observable<UserCredential> {
    const provider = new firebase.auth.FacebookAuthProvider();
    return from(this.afAuth.signInWithPopup(provider)).pipe(
      catchError((error) => {
        console.error('Error signing in with Facebook:', error);
        return throwError(error);
      })
    );
  }

  signOut(): Promise<void> {
    return this.afAuth.signOut().catch((error) => {
      console.error('Error signing out:', error);
      throw error;
    });
  }
  
  updateUserProfile(name: string, email: string): Observable<void> {
    return this.getCurrentUser().pipe(
      switchMap((user) => {
        if (user) {
          const userId = user.uid;
          return from(this.firestore.collection('users').doc(userId).update({ name, email })).pipe(
            catchError((error) => {
              console.error('Error updating user profile:', error);
              return throwError(error);
            })
          );
        } else {
          return throwError(new Error('User not authenticated'));
        }
      })
    );
  }

  changeUserPassword(currentPassword: string, newPassword: string): Observable<void> {
    return this.getCurrentUser().pipe(
      switchMap((user) => {
        if (user) {
          const credential = firebase.auth.EmailAuthProvider.credential(user.email || '', currentPassword);
          return from(user.reauthenticateWithCredential(credential)).pipe(
            switchMap(() => from(user.updatePassword(newPassword))),
            catchError((error) => {
              console.error('Error changing password:', error);
              return throwError(error);
            })
          );
        } else {
          return throwError(new Error('User not authenticated'));
        }
      })
    );
  }

  getCurrentUser(): Observable<User | null> {
    return this.afAuth.authState.pipe(take(1));
  }

  unsubscribeAuthState(): void {
    // Implement the logic for unsubscribing authState here
  }
  
}


/* src\app\components\services\brand\brand.service.ts */

import { Injectable } from '@angular/core';
import { map, Observable, from } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Brand } from '../../../models/brand.model';
import {
  collection,
  CollectionReference,
  doc,
  DocumentData,
  getDoc,
  getDocs,
  getFirestore,
  query,
  QuerySnapshot,
  orderBy,
} from 'firebase/firestore';
import { environment } from 'src/environments/environment';
import { initializeApp } from 'firebase/app';

@Injectable({
  providedIn: 'root',
})
export class BrandService {
  private firestore: any;
  private collectionRef: CollectionReference<DocumentData>;

  constructor() {
    const app = initializeApp(environment.firebase);
    const firestore = getFirestore(app);
    this.collectionRef = collection(firestore, 'brands');
  }

  getBrands(): Observable<Brand[]> {
    const brandsQuery = query(this.collectionRef, orderBy('brand'));
    return from(getDocs(brandsQuery)).pipe(
      map((querySnapshot: QuerySnapshot<DocumentData>) =>
        querySnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() as Brand }))
      )
    );
  }

  getBrandById(id: string): Observable<Brand> {
    const brandDocRef = doc(this.collectionRef, id);
    return new Observable((observer) => {
      getDoc(brandDocRef)
        .then((brandDoc: DocumentData) => {
          if (brandDoc['exists']()) {
            const brand = brandDoc['data']() as Brand;
            brand.id = brandDoc['id'];
            observer.next(brand);
          } else {
            observer.error('Brand not found');
          }
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }
}


/* src\app\components\services\cart.service.ts */

import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { Product } from '../../models/product.model';

@Injectable({
  providedIn: 'root'
})
export class CartService {
  private products: Product[] = [];
  private cartItemCount: number = 0;

  getCartItemCount(): number {
    return this.cartItemCount;
  }

  addProduct(product: Product): void {
    this.products.push(product);
    this.cartItemCount++;
  }

  removeProduct(product: Product): void {
    const index = this.products.findIndex(p => p.id === product.id);
    if (index !== -1) {
      this.products.splice(index, 1);
      this.cartItemCount--;
    }
  }

  getProducts(): Product[] {
    return this.products;
  }

  clearCart(): void {
    this.products = [];
    this.cartItemCount = 0;
  }

  getTotal(): number {
    return this.products.reduce((acc, product) => acc + product.price, 0);
  }
}


/* src\app\components\services\firebase-test\firebase-test.component.html */

<p>firebase-test works!</p>


/* src\app\components\services\firebase-test\firebase-test.component.ts */

import { Component, OnInit } from '@angular/core';
import { AngularFirestore } from '@angular/fire/compat/firestore';

@Component({
  selector: 'app-firebase-test',
  templateUrl: './firebase-test.component.html',
  styleUrls: ['./firebase-test.component.scss']
})
export class FirebaseTestComponent implements OnInit {

  constructor(private firestore: AngularFirestore) { }

  ngOnInit(): void {
    // Verificar la conexión a Firebase
    console.log('Conectando a Firebase...');
    this.firestore.firestore.enableNetwork().then(() => {
      console.log('Conectado a Firebase!');
      // Leer datos de Firestore
      this.firestore.collection('products').get().subscribe((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          console.log(doc.id, ' => ', doc.data());
        });
      });
    }).catch((error) => {
      console.log('Error de conexión:', error);
    });
  }
}


/* src\app\components\services\location.service.ts */

import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, BehaviorSubject } from 'rxjs';
import { map } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class LocationService {
  private apiUrl = 'https://www.datos.gov.co/resource/xdk5-pm3f.json';
  private departmentsSubject = new BehaviorSubject<string[]>([]);
  departments$ = this.departmentsSubject.asObservable();
  private citiesSubject = new BehaviorSubject<string[]>([]);
  cities$ = this.citiesSubject.asObservable();

  constructor(private http: HttpClient) {
    this.fetchDepartments();
  }

  private fetchDepartments(): void {
    this.http.get<any[]>(this.apiUrl).subscribe(
      (departments) => {
        // Remove duplicates by using a Set to store unique departments
        const uniqueDepartments = new Set(departments.map((department) => department.departamento));
        this.departmentsSubject.next([...uniqueDepartments]);
      },
      (error) => {
        console.error('Error fetching departments:', error);
      }
    );
  }

  getCitiesByDepartment(departmentId: string): Observable<any[]> {
    if (departmentId) {
      const params = { departamento: departmentId };
      return this.http.get<any[]>(this.apiUrl, { params }).pipe(
        map((cities) => {
          // Extract city names (municipios) and emit as an array of strings
          return cities.map((city) => city.municipio); // Modify "ciudad" to "municipio"
        })
      );
    } else {
      // If no department selected, emit an empty array of cities
      return this.citiesSubject.pipe(map(() => []));
    }
  }
}


/* src\app\components\services\payment\mercadopago.service.ts */

import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class MercadopagoService {

  constructor() { }
}


/* src\app\components\services\product\image-index.mixin.ts */

// image-index.mixin.ts

export interface ImageIndexMixin {
    currentImageIndex: number;
  }

/* src\app\components\services\product.service.ts */

import { initializeApp } from 'firebase/app';
import { Injectable } from '@angular/core';
import { map, Observable, from } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { Product } from '../../models/product.model';
import {
  collection,
  CollectionReference,
  deleteDoc,
  doc,
  DocumentData,
  getDoc,
  getDocs,
  getFirestore,
  limit,
  orderBy,
  query,
  QuerySnapshot,
  setDoc,
  updateDoc,
  where,
} from 'firebase/firestore';
import { environment } from 'src/environments/environment';
import { CsvParserService } from '../../services/csv-parser.service';
import { CsvWriterService } from '../../services/csv-writer.service';
import { Subject } from 'rxjs';
import { Brand } from 'src/app/models/brand.model';

@Injectable({
  providedIn: 'root',
})
export class ProductService {
  getProduct(productId: any) {
    throw new Error('Method not implemented.');
  }
  private firestore: any;
  private collectionRef: CollectionReference<DocumentData>;
  private addToCartSubject: Subject<Product> = new Subject<Product>();
  addToCart$: Observable<Product> = this.addToCartSubject.asObservable();

  addProductToCart(product: Product) {
    this.addToCartSubject.next(product);
  }

  constructor(private csvParserService: CsvParserService) {
    const app = initializeApp(environment.firebase);
    const firestore = getFirestore(app);
    this.collectionRef = collection(firestore, 'productos');

    const file = new File([''], 'products.csv'); // Crear objeto File vacío con el nombre del archivo
    this.csvParserService.importProductsFromCSV(file);
  }

  getProducts(): Observable<Product[]> {
    const productsQuery = query(this.collectionRef, orderBy('name'));
    return from(getDocs(productsQuery)).pipe(
      map((querySnapshot: QuerySnapshot<DocumentData>) =>
        querySnapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data() as Product,
        }))
      )
    );
  }

  getProductById(id: string): Observable<Product> {
    const productDocRef = doc(this.collectionRef, id);
    return new Observable((observer) => {
      getDoc(productDocRef)
        .then((productDoc: DocumentData) => {
          if (productDoc['exists']()) {
            const product = productDoc['data']() as Product;
            product.id = productDoc['id'];
            observer.next(product);
          } else {
            observer.error('Product not found');
          }
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  createProduct(product: Product): Observable<Product> {
    const id = this.firestore.createId();
    product.id = id;
    return new Observable((observer) => {
      setDoc(doc(this.collectionRef, product.id), product)
        .then(() => {
          const newProduct = { ...product };
          observer.next(newProduct);
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  updateProduct(product: Product): Observable<void> {
    const productDocRef = doc(this.collectionRef, product.id);
    return new Observable((observer) => {
      updateDoc(productDocRef, product as any)
        .then(() => {
          observer.next();
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  deleteProduct(id: string): Observable<void> {
    const productDocRef = doc(this.collectionRef, id);
    return new Observable((observer) => {
      deleteDoc(productDocRef)
        .then(() => {
          observer.next();
        })
        .catch((error) => {
          observer.error(error);
        });
    });
  }

  getBrands(): Observable<Brand[]> {
    const brandsQuery = query(collection(this.collectionRef.firestore, 'brands'), orderBy('name'));
    return from(getDocs(brandsQuery)).pipe(
      map((querySnapshot: QuerySnapshot<DocumentData>) =>
        querySnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() as Brand }))
      )
    );
  }
}


/* src\app\components\user-panel\user-auth.guard.ts */

import { Injectable } from '@angular/core';
import { ActivatedRouteSnapshot, CanActivate, CanActivateChild, RouterStateSnapshot, UrlTree } from '@angular/router';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class UserAuthGuard implements CanActivate, CanActivateChild {
  canActivate(
    route: ActivatedRouteSnapshot,
    state: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    return true;
  }
  canActivateChild(
    childRoute: ActivatedRouteSnapshot,
    state: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    return true;
  }
  
}


/* src\app\components\user-panel\user-panel.component.html */

<div class="container">
  <div class="menu">
    <ul class="menu-items">
      <li class="menu-item" (click)="selectModule('profile')">Profile</li>
      <li class="menu-item" (click)="selectModule('password')">Change Password</li>
      <li class="menu-item" (click)="selectModule('orders')">Pedidos</li>
      <li class="menu-item" (click)="selectModule('addresses')">Direcciones</li>
      <li class="menu-item" (click)="selectModule('account')">Detalles de la Cuenta</li>
      <li class="menu-item" (click)="selectModule('wishlist')">Lista de Deseos</li>
      <li class="menu-item" (click)="selectModule('logout')">Salir</li>
    </ul>
  </div>

  <div class="content">
    <h2 *ngIf="selectedModule === 'profile'">User Profile</h2>
    <form *ngIf="selectedModule === 'profile'" [formGroup]="profileForm">
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" formControlName="name" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" formControlName="email" class="form-control" required>
      </div>
      <!-- Add more profile fields as needed -->
      <button type="button" class="btn btn-primary" (click)="updateProfile()">Update Profile</button>
    </form>
    <div *ngIf="selectedModule === 'profile'">
      <h4>Name: {{ profileForm.get('name')?.value }}</h4>
      <h4>Email: {{ profileForm.get('email')?.value }}</h4>
    </div>

    <h2 *ngIf="selectedModule === 'password'">Change Password</h2>
    <form *ngIf="selectedModule === 'password'" [formGroup]="passwordForm">
      <div class="form-group">
        <label for="currentPassword">Current Password</label>
        <input type="password" formControlName="currentPassword" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <input type="password" formControlName="newPassword" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <input type="password" formControlName="confirmPassword" class="form-control" required>
        <div *ngIf="passwordForm.hasError('passwordMismatch')" class="password-mismatch-error">
          Passwords do not match
        </div>
      </div>
      <button type="button" class="btn btn-primary" (click)="changePassword()">Change Password</button>
    </form>

    <h2 *ngIf="selectedModule === 'orders'">Pedidos</h2>
    <div *ngIf="selectedModule === 'orders'" class="module-content">
      <!-- Pedidos module content -->
    </div>

    <h2 *ngIf="selectedModule === 'addresses'">Direcciones</h2>
    <div *ngIf="selectedModule === 'addresses'" class="module-content">
      <!-- Direcciones module content -->
    </div>

    <h2 *ngIf="selectedModule === 'account'">Detalles de la Cuenta</h2>
    <div *ngIf="selectedModule === 'account'" class="module-content">
      <!-- Detalles de la Cuenta module content -->
    </div>

    <h2 *ngIf="selectedModule === 'wishlist'">Lista de Deseos</h2>
    <div *ngIf="selectedModule === 'wishlist'" class="module-content">
      <!-- Lista de Deseos module content -->
    </div>

    <div *ngIf="selectedModule === 'logout'" class="module-content">
      <button type="button" class="btn btn-primary" (click)="logout()">Logout</button>
    </div>
  </div>
</div>


/* src\app\components\user-panel\user-panel.component.ts */

import { Component, OnDestroy, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { AuthService } from '../services/auth/auth.service';
import { MatSnackBar } from '@angular/material/snack-bar';
import { Subscription } from 'rxjs';
import firebase from 'firebase/compat/app';
import { User } from '@firebase/auth-types';

@Component({
  selector: 'app-user-panel',
  templateUrl: './user-panel.component.html',
  styleUrls: ['./user-panel.component.scss']
})
export class UserPanelComponent implements OnInit, OnDestroy {
  profileForm: FormGroup;
  passwordForm: FormGroup;
  selectedModule: string;
  currentUser: User | null;
  currentUserSubscription: Subscription;

  constructor(
    private formBuilder: FormBuilder,
    private authService: AuthService,
    private snackBar: MatSnackBar
  ) {}

  ngOnDestroy(): void {
    if (this.currentUserSubscription) {
      this.currentUserSubscription.unsubscribe();
    }
  }

  ngOnInit(): void {
    this.selectedModule = 'profile';

    this.profileForm = this.formBuilder.group({
      name: ['', Validators.required],
      email: ['', [Validators.required, Validators.email]],
      // Add more profile fields as needed
    });

    this.passwordForm = this.formBuilder.group(
      {
        currentPassword: ['', Validators.required],
        newPassword: ['', [Validators.required, Validators.minLength(6)]],
        confirmPassword: ['', Validators.required]
      },
      { validator: this.passwordMatchValidator }
    );

    this.currentUserSubscription = this.authService.getCurrentUser().subscribe((value: User | null) => {
      if (value) {
        this.currentUser = value;
        this.profileForm.patchValue({
          name: value.displayName || '',
          email: value.email || ''
        });
      }
    });
  }

  passwordMatchValidator(formGroup: FormGroup): void {
    const newPassword = formGroup.get('newPassword')?.value;
    const confirmPassword = formGroup.get('confirmPassword')?.value;

    if (newPassword !== confirmPassword) {
      formGroup.get('confirmPassword')?.setErrors({ passwordMismatch: true });
    } else {
      formGroup.get('confirmPassword')?.setErrors(null);
    }
  }

  selectModule(module: string): void {
    this.selectedModule = module;
  }

  updateProfile(): void {
    if (this.profileForm.valid) {
      const { name, email } = this.profileForm.value;
      this.authService.updateUserProfile(name, email)
        .subscribe(
          () => {
            this.showSuccessMessage('Profile updated successfully');
          },
          (error: any) => {
            this.showErrorMessage('Failed to update profile');
            console.error(error);
          }
        );
    }
  }

  changePassword(): void {
    if (this.passwordForm.valid) {
      const { currentPassword, newPassword } = this.passwordForm.value;
      this.authService.changeUserPassword(currentPassword, newPassword)
        .subscribe(
          () => {
            this.showSuccessMessage('Password changed successfully');
          },
          (error: any) => {
            this.showErrorMessage('Failed to change password');
            console.error(error);
          }
        );
    }
  }

  logout(): void {
    this.authService.signOut()
      .then(() => {
        // Handle successful logout
      })
      .catch((error: any) => {
        console.error('Logout error:', error);
      });
  }

  showErrorMessage(message: string): void {
    this.snackBar.open(message, 'Close', { duration: 3000 });
  }

  showSuccessMessage(message: string): void {
    this.snackBar.open(message, 'Close', { duration: 3000 });
  }
}
